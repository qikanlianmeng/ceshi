<?php
 defined('IN_IA') or exit('Access Denied'); class Navlange_pincheModuleSite extends WeModuleSite { public function rtrim_cn($str, $trim, $charset = "UTF-8") { goto tfsNB; ZuZCP: Cv1Yi: goto GRkjo; Bne6K: goto EK2RI; goto ZuZCP; k3LI_: EK2RI: goto DWXf2; YKLWb: if (mb_substr($str, $len - 1, 1, $charset) == $trim) { goto Cv1Yi; } goto nXZks; YKKW9: jiemE: goto YKLWb; GRkjo: return mb_substr($str, 0, $len - 1, $charset); goto k3LI_; tfsNB: $len = mb_strlen($str, $charset); goto imN_p; wYLOQ: return; goto YKKW9; nXZks: return $str; goto Bne6K; imN_p: if ($len) { goto jiemE; } goto wYLOQ; DWXf2: } function createCode($userId) { goto WTYgh; rxpWH: if (!$num) { goto jysK0; } goto chG82; Wn02b: jysK0: goto d3f7o; Yyqit: if (!empty($code[4])) { goto ok2jh; } goto Wb7FQ; bJRVa: $code = "{$sourceString[$mod]}{$code}"; goto FqxEw; aPNs_: $num = (int) ($num / 36); goto bJRVa; MPsRT: Wm2sz: goto tUf0V; jWOPK: $code = '0' . $code; goto MPsRT; B_rBh: $num = $userId; goto LcNH2; Wb7FQ: $code = $sourceString[rand(0, 36)] . $code; goto HKxQB; FqxEw: goto jv513; goto Wn02b; haN24: ok2jh: goto VpodS; Vs4FA: jv513: goto rxpWH; tUf0V: return $code; goto N4ns3; chG82: $mod = $num % 36; goto aPNs_; LcNH2: $code = ''; goto Vs4FA; VpodS: if (!empty($code[5])) { goto Wm2sz; } goto jWOPK; d3f7o: pNiw2: goto Yyqit; WTYgh: static $sourceString = array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"); goto B_rBh; HKxQB: goto pNiw2; goto haN24; N4ns3: } public function qc_template($filename) { goto Z8ISu; tX246: if (empty($show_module)) { goto jIykl; } goto Qipfp; JQqkG: kb1ll: goto dpd2R; Ozry_: if (empty($zl_module)) { goto qSCiQ; } goto xEfwv; wGFsN: if (empty($place_module)) { goto r6dnD; } goto CwTc8; VFBSg: $source = IA_ROOT . '/addons/navlange_pinche/template/common/' . $filename . '.html'; goto Ch3HE; NTDX2: array_push($business_list, array("module" => "navlange_ktv", "name" => "包房预订")); goto BrbDO; Z8ISu: global $_W; goto Zz0Jk; PJ3xg: a9RD_: goto sUGUT; ZkvnW: QCq4m: goto VsxNf; VsxNf: if (is_file($source)) { goto a9RD_; } goto M6yke; xMv18: qSCiQ: goto CcQLE; aLo8V: array_push($business_list, array("module" => "navlange_shop", "name" => "商城")); goto A8wX9; Zz0Jk: $business_list = array(); goto cbSc3; KPrl1: fIM19: goto yx6Lg; SCvIu: uhnhD: goto JQqkG; kwD6P: if (is_file($source)) { goto QCq4m; } goto jWa7J; VFaBn: wK0H9: goto lAGAJ; UgM3s: KFDz8: goto f59p_; qdphS: array_push($business_list, array("module" => "navlange_people", "name" => "租我")); goto UgM3s; hXSbH: sUXD1: goto kMIM9; sUGUT: if (!(DEVELOPMENT || !is_file($compile) || filemtime($source) > filemtime($compile))) { goto fIM19; } goto w3eRJ; Kc2tY: if (empty($master_module)) { goto sUXD1; } goto XVioX; mCMwq: $compile = IA_ROOT . "/data/tpl/web/default/{$filename}.tpl.php"; goto ZkvnW; RuWN5: return ''; goto PJ3xg; BrbDO: vZ0LW: goto yxlrM; h6g3Z: r6dnD: goto pieCI; w3eRJ: template_compile($source, $compile); goto KPrl1; cbSc3: $zl_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_reserve_service\''); goto Ozry_; CcQLE: $shop_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_shop\''); goto wlkRQ; M6yke: echo "template source '{$filename}' is not exist!"; goto RuWN5; F1ElO: if (empty($ktv_module)) { goto vZ0LW; } goto NTDX2; BG3t5: array_push($business_list, array("module" => "navlange_cwash", "name" => "洗车")); goto P1_qo; VUK3d: $master_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_reserve_master\''); goto Kc2tY; pieCI: $pinche_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_pinche\''); goto WRweA; lP0w5: if (empty($cwash_module)) { goto uj8Gz; } goto BG3t5; Ch3HE: $compile = IA_ROOT . '/data/tpl/web/' . $this->module['name'] . '/' . $filename . '.tpl.php'; goto kwD6P; f59p_: $ktv_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_ktv\''); goto F1ElO; XlVwJ: $fx_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_fx\''); goto VFBSg; WRweA: if (empty($pinche_module)) { goto wK0H9; } goto pmIlL; hgvbe: if (empty($people_module)) { goto KFDz8; } goto qdphS; xEfwv: array_push($business_list, array("module" => "navlange_reserve_service", "name" => "租赁")); goto xMv18; kMIM9: $place_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_reserve_place\''); goto wGFsN; XVioX: array_push($business_list, array("module" => "navlange_reserve_master", "name" => "O2O")); goto hXSbH; J8kUl: $cwash_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_cwash\''); goto lP0w5; yx6Lg: switch ($flag) { case TEMPLATE_DISPLAY: default: goto jVIPK; jVIPK: extract($GLOBALS, EXTR_SKIP); goto EEd14; EEd14: include $compile; goto oS1ti; oS1ti: goto kb1ll; goto bUDpr; bUDpr: case TEMPLATE_FETCH: goto Z6Z6S; Ke2WU: ob_clean(); goto wmp6Z; ioXtl: $contents = ob_get_contents(); goto Ke2WU; i5jcP: ob_flush(); goto n1J6y; n1J6y: ob_clean(); goto WnEeg; Z6Z6S: extract($GLOBALS, EXTR_SKIP); goto i5jcP; jB35E: include $compile; goto ioXtl; wmp6Z: return $contents; goto conIK; conIK: goto kb1ll; goto MImbK; WnEeg: ob_start(); goto jB35E; MImbK: case TEMPLATE_INCLUDEPATH: return $compile; goto kb1ll; } goto SCvIu; lAGAJ: $people_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_people\''); goto hgvbe; pmIlL: array_push($business_list, array("module" => "navlange_pinche", "name" => "拼车带货")); goto VFaBn; yxlrM: $show_module = pdo_fetch('SELECT mid FROM ' . tablename('modules') . ' WHERE name=\'navlange_reserve_show\''); goto tX246; Qipfp: array_push($business_list, array("module" => "navlange_reserve_show", "name" => "选座订票")); goto nJBXC; P1_qo: uj8Gz: goto XlVwJ; nJBXC: jIykl: goto J8kUl; jWa7J: $source = IA_ROOT . "/web/themes/default/{$filename}.html"; goto mCMwq; wlkRQ: if (empty($shop_module)) { goto fx22X; } goto aLo8V; A8wX9: fx22X: goto VUK3d; CwTc8: array_push($business_list, array("module" => "navlange_reserve_place", "name" => "场地预订")); goto h6g3Z; dpd2R: } public function permission() { goto FZ3_u; cYsGJ: return 'STORE'; goto caHz5; AaNnr: y9W63: goto gC6l7; Kvix3: $is_store = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_store') . ' WHERE admin_uid=' . $_W['uid']); goto VnEKr; gC6l7: return 'ADMIN'; goto flS2M; flS2M: o4TAW: goto WEf5M; caHz5: goto o4TAW; goto AaNnr; VnEKr: if (empty($is_store)) { goto y9W63; } goto cYsGJ; FZ3_u: global $_W; goto Kvix3; WEf5M: } public function qc_template_mobile($filename) { goto lkr2_; CdFup: mqSAY: goto pjlHc; Zo_h2: if (!(DEVELOPMENT || !is_file($compile) || filemtime($source) > filemtime($compile))) { goto mqSAY; } goto QETRA; pjlHc: switch ($flag) { case TEMPLATE_DISPLAY: default: goto ECSo1; mHPhG: goto wmu6D; goto ik9lq; ECSo1: extract($GLOBALS, EXTR_SKIP); goto MFO0u; MFO0u: include $compile; goto mHPhG; ik9lq: case TEMPLATE_FETCH: goto lHN1v; DpArn: $contents = ob_get_contents(); goto I3f3s; B1vSq: return $contents; goto hvpj4; lHN1v: extract($GLOBALS, EXTR_SKIP); goto pQkKz; I3f3s: ob_clean(); goto B1vSq; pQkKz: ob_flush(); goto ucT2S; eovyj: ob_start(); goto ztprm; hvpj4: goto wmu6D; goto LBukn; ucT2S: ob_clean(); goto eovyj; ztprm: include $compile; goto DpArn; LBukn: case TEMPLATE_INCLUDEPATH: return $compile; goto wmu6D; } goto i98jL; i98jL: xhBV5: goto pVFki; rfPxh: echo "template source '{$filename}' is not exist!"; goto llmQO; usDq_: $compile = IA_ROOT . "/data/tpl/app/default/{$filename}.tpl.php"; goto lcf62; llmQO: return ''; goto UCwXL; lZG8W: $compile = IA_ROOT . '/data/tpl/app/' . $this->module['name'] . '/' . $filename . '_mobile.tpl.php'; goto Kp99h; SeEAC: $source = IA_ROOT . "/app/themes/default/{$filename}.html"; goto usDq_; pVFki: wmu6D: goto qlnNt; UCwXL: L7Esp: goto Zo_h2; lkr2_: global $_W; goto kgRtA; kgRtA: $source = IA_ROOT . '/addons/navlange_pinche/template/common/' . $filename . '_mobile.html'; goto lZG8W; QETRA: template_compile($source, $compile); goto CdFup; Kp99h: if (is_file($source)) { goto w3RMZ; } goto SeEAC; lcf62: w3RMZ: goto MrG31; MrG31: if (is_file($source)) { goto L7Esp; } goto rfPxh; qlnNt: } public function check_mobile_login() { goto cDtKf; cuLKo: return false; goto bgw9H; klovW: if (!(!empty($_W['member']) && (!empty($_W['member']['mobile']) || !empty($_W['member']['email'])))) { goto kukYv; } goto L2Ga_; AKdkE: ZNfCD: goto cuLKo; hY2Iw: kukYv: goto Ec0Tj; L2Ga_: return true; goto hY2Iw; dY961: $fan = pdo_fetch('SELECT uid FROM ' . tablename('mc_mapping_fans') . ' WHERE openid=\'' . $_W['openid'] . '\''); goto zsjQU; S3YfT: return true; goto XMI0Q; zsjQU: if (!$this->mobile_login(array("uid" => intval($fan['uid'])))) { goto tEokD; } goto S3YfT; Ec0Tj: if (empty($_W['openid'])) { goto ZNfCD; } goto dY961; cDtKf: global $_W; goto klovW; XMI0Q: tEokD: goto AKdkE; bgw9H: } public function mobile_login($member) { goto kQhTZ; EqANc: if (!empty($_W['openid'])) { goto qamLV; } goto yKUdr; srUWE: if (!(!empty($member) && !empty($member['uid']))) { goto T5ZZ0; } goto MoCs0; H9_tE: mc_group_update(); goto EqANc; ComXF: return true; goto VPlPY; IDvXL: $_W['openid'] = $member['uid']; goto X2Ous; qiYu_: qamLV: goto XiPtd; xaPr6: $_W['member'] = $member; goto okvIv; t8kD5: $_W['fans']['from_user'] = $_W['openid']; goto xLvSW; WtQ7o: if (!empty($fan)) { goto AQkrz; } goto IDvXL; X2Ous: $_W['fans'] = array("from_user" => $member['uid'], "follow" => 0); goto GJRJX; XiPtd: isetcookie('logout', '', -60000); goto ComXF; aaeYA: $_W['openid'] = $fan['openid']; goto LEr6V; UBhb7: AQkrz: goto S6ZkT; xLvSW: tIQfk: goto qiYu_; yKUdr: $fan = pdo_fetch('SELECT * FROM ' . tablename('mc_mapping_fans') . ' WHERE uid=' . $member['uid']); goto WtQ7o; kQhTZ: global $_W; goto srUWE; S6ZkT: $_SESSION['openid'] = $fan['openid']; goto aaeYA; VPlPY: N7WAi: goto TQM4J; l_oyS: if (!(!empty($member) && (!empty($member['mobile']) || !empty($member['email'])))) { goto N7WAi; } goto xaPr6; MoCs0: $member = pdo_get('mc_members', array("uid" => $member['uid'], "uniacid" => $_W['uniacid']), array("uid", "realname", "mobile", "email", "groupid", "credit1", "     credit2", "credit6")); goto l_oyS; LEr6V: $_W['fans'] = $fan; goto t8kD5; GJRJX: goto tIQfk; goto UBhb7; okvIv: $_W['member']['groupname'] = $_W['uniaccount']['groups'][$member['groupid']]['title']; goto jKvu9; Ix32o: return false; goto dTc3c; jKvu9: $_SESSION['uid'] = $member['uid']; goto H9_tE; TQM4J: T5ZZ0: goto Ix32o; dTc3c: } public function hidtel($phone) { goto nk5Ny; HRT8j: return preg_replace('/(1[358]{1}[0-9])[0-9]{4}([0-9]{4})/i', '$1****$2', $phone); goto Yu16O; ik3_u: if ($IsWhat == 1) { goto h3hbt; } goto HRT8j; nk5Ny: $IsWhat = preg_match('/(0[0-9]{2,3}[\\-]?[2-9][0-9]{6,7}[\\-]?[0-9]?)/i', $phone); goto ik3_u; nuMD3: OLthy: goto IqUq_; i_LUG: h3hbt: goto ncjiA; ncjiA: return preg_replace('/(0[0-9]{2,3}[\\-]?[2-9])[0-9]{3,4}([0-9]{3}[\\-]?[0-9]?)/i', '$1****$2', $phone); goto nuMD3; Yu16O: goto OLthy; goto i_LUG; IqUq_: } public function doMobileUpload_image() { goto u9ScI; P3ZF1: $filename = file_random_name(ATTACHMENT_ROOT . '/' . $path, $ext); goto rIYeK; ShAkk: TE9PU: goto EdqcE; gZOci: $info['id'] = pdo_insertid(); goto LtwuB; MsHxI: $size = getimagesize($fullname); goto OxsUk; R1FJc: $path = 'images/' . intval($_W['uniacid']) . '/' . date('Y/m/'); goto cAu9g; fYR1v: $data['uniacid'] = $_W['uniacid']; goto APPV1; FWDG6: Y4GEk: goto lKJl8; JkA99: YOIy8: goto Tm8Mt; Kfur1: file_delete($pathname); goto vShBu; wTmpB: goto TE9PU; goto FGrCD; Keyqd: $img = base64_decode(str_replace($img_result[1], '', $base64_image_content)); goto FWDG6; qzlLc: $result['message'] = '远程附件上传失败，请检查配置并重新上传'; goto Kfur1; LtwuB: if (!($_GPC['scene'] == 'yx')) { goto nR61R; } goto MP3Pn; oGXrV: $thumb = empty($setting['thumb']) ? 0 : 1; goto GyfEq; JpvXf: $type = $img_result[2]; goto Keyqd; vShBu: die(json_encode($result)); goto ShAkk; lPLAu: if (is_error($thumbnail)) { goto C3YOs; } goto h_VG8; wx3T7: fclose($imgfile); goto oGXrV; jL0VM: if (!preg_match('/^(data:\\s*image\\/(\\w+);base64,)/', $base64_image_content, $img_result)) { goto Y4GEk; } goto JpvXf; LzIt9: $info['height'] = $size[1]; goto g5vY4; tCM2D: $info = array("name" => $_FILES['file']['name'], "ext" => $ext, "filename" => $pathname, "attachment" => $pathname, "url" => tomedia($pathname), "is_image" => 1, "filesize" => filesize($fullname)); goto MsHxI; Tm8Mt: yMebY: goto tCM2D; FGrCD: ndcUB: goto qzlLc; nsyM0: $result = array("jsonrpc" => "2.0", "id" => "id", "error" => array("code" => 1, "message" => "")); goto tAH4J; vn0ta: $result['message'] = $thumbnail['message']; goto FHHEV; LKiDp: if (!($thumb == 1 && $width > 0 && (!isset($_GPC['thumb']) || isset($_GPC['thumb']) && !empty($_GPC['thumb'])))) { goto yMebY; } goto Yc9tm; c3rtI: message(error(0, $info), '', 'ajax'); goto rGZJY; NvHd5: goto YOIy8; goto GIZVf; lKWOO: pdo_insert('navlange_reserve_master_customer_gallery', $data); goto R8jwP; EdqcE: qqR88: goto ndijN; cAu9g: mkdirs(ATTACHMENT_ROOT . '/' . $path); goto P3ZF1; FHHEV: die(json_encode($result)); goto JkA99; TXQ65: file_delete($pathname); goto X83vU; GIZVf: C3YOs: goto vn0ta; tAH4J: $base64_image_content = $_GPC['img']; goto jL0VM; OxsUk: $info['width'] = $size[0]; goto LzIt9; GRR1s: if (is_error($remotestatus)) { goto ndcUB; } goto TXQ65; tbrwY: $data['img'] = $info['filename']; goto jKxRZ; MP3Pn: $data = array(); goto fYR1v; mkrI0: $fullname = ATTACHMENT_ROOT . '/' . $pathname; goto NvHd5; c3p6b: fwrite($imgfile, $img); goto wx3T7; eiN1P: $data['customer_uid'] = pdo_fetchcolumn('SELECT uid FROM ' . tablename('navlange_reserve_master_customer') . ' WHERE id=' . $_GPC['customer_id']); goto tbrwY; dRtHy: $remotestatus = file_remote_upload($pathname); goto GRR1s; Kn4BB: $ext = strtolower($type); goto R1FJc; rIYeK: $pathname = $path . $filename; goto to_rE; R8jwP: $yx_id = pdo_insertid(); goto XjctP; GyfEq: $width = intval($setting['width']); goto LKiDp; ndijN: pdo_insert('core_attachment', array("uniacid" => $uniacid, "uid" => $_W['uid'], "filename" => $_FILES['file']['name'], "attachment" => $pathname, "type" => $type == 'image' ? 1 : 2, "createtime" => TIMESTAMP)); goto gZOci; ECwlB: $setting = $_W['setting']['upload']['image']; goto nsyM0; jKxRZ: $data['scene'] = $_GPC['scene']; goto lKWOO; u9ScI: global $_W, $_GPC; goto ECwlB; TzRlQ: $pathname = $thumbnail; goto mkrI0; yWW4v: nR61R: goto c3rtI; bLN7S: @unlink($fullname); goto lPLAu; g5vY4: setting_load('remote'); goto CZw7O; APPV1: $data['customer_id'] = $_GPC['customer_id']; goto eiN1P; X83vU: $info['url'] = tomedia($pathname); goto wTmpB; rrobn: $imgfile = fopen($fullname, 'w'); goto c3p6b; lKJl8: load()->func('file'); goto Kn4BB; Yc9tm: $thumbnail = file_image_thumb($fullname, '', $width); goto bLN7S; h_VG8: $filename = pathinfo($thumbnail, PATHINFO_BASENAME); goto TzRlQ; CZw7O: if (empty($_W['setting']['remote']['type'])) { goto qqR88; } goto dRtHy; to_rE: $fullname = ATTACHMENT_ROOT . '/' . $pathname; goto rrobn; XjctP: $info['yx_id'] = $yx_id; goto yWW4v; rGZJY: } function httpPost($url, $jsonData) { goto bwiLI; PlPvL: if (!curl_errno($curl)) { goto Lnyfm; } goto u6aAy; xw2RM: $result = curl_exec($curl); goto PlPvL; v0fmd: curl_setopt($curl, CURLOPT_POSTFIELDS, $jsonData); goto iBtFt; EXyWd: curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE); goto Y1KeP; bwiLI: $curl = curl_init(); goto ylHy7; iBtFt: curl_setopt($curl, CURLOPT_TIMEOUT, 30); goto DNgt2; u6aAy: $this->ErrorLogger('curl falied. Error Info: ' . curl_error($curl)); goto vxkWU; JIIMr: return $result; goto eSLPx; uxGQ0: curl_close($curl); goto JIIMr; hBS34: curl_setopt($curl, CURLOPT_POST, 1); goto v0fmd; vxkWU: Lnyfm: goto uxGQ0; DNgt2: curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); goto xw2RM; ylHy7: curl_setopt($curl, CURLOPT_URL, $url); goto EXyWd; Y1KeP: curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE); goto hBS34; eSLPx: } public function doMobileUpdate_mobile() { goto jhs9R; w0uF0: message(error(0, ''), '', 'ajax'); goto soRGI; jhs9R: global $_W, $_GPC; goto iXG3g; iXG3g: pdo_update('mc_members', array("mobile" => $_GPC['mobile']), array("uid" => $_W['member']['uid'])); goto w0uF0; soRGI: } public function doMobileSuggestion_submit() { goto bssQJ; z2m7C: $item['uid'] = $_W['member']['uid']; goto WkNbl; MADNy: $item['uniacid'] = $_W['uniacid']; goto z2m7C; bssQJ: global $_W, $_GPC; goto MADNy; hRJy7: $item['content'] = $_GPC['content']; goto pV47R; WkNbl: $item['openid'] = $_W['openid']; goto KEfQv; pV47R: $item['release_time'] = TIMESTAMP; goto jgWTm; jgWTm: pdo_insert('navlange_pinche_suggestion', $item); goto pfLlc; KEfQv: $item['name'] = $_GPC['name']; goto B2oZw; pfLlc: message(error(0, ''), '', 'ajax'); goto z6P0A; B2oZw: $item['mobile'] = $_GPC['mobile']; goto hRJy7; z6P0A: } public function doMobilePayDebug() { goto m8ttR; wqU6A: message(error(0, ''), '', 'ajax'); goto tFt6q; S0huB: $this->payResult($params); goto T2Sao; htWUl: $params['result'] = 'success'; goto pOAmm; RWXf9: o3dBi: goto OylAc; bfvVD: if ($_GPC['__input']) { goto o3dBi; } goto V2xFs; tFt6q: znTg8: goto swSpM; m8ttR: global $_W, $_GPC; goto bfvVD; pOAmm: Qk_O7: goto S0huB; V2xFs: $params['from'] = $_GPC['from']; goto Hh8a6; Yr0Dt: $params['tid'] = $_GPC['__input']['tid']; goto UN1HS; Hh8a6: $params['tid'] = $_GPC['tid']; goto Z_AeK; Jn3PR: goto Qk_O7; goto RWXf9; E3vnR: $params['result'] = 'success'; goto Jn3PR; OylAc: $params['from'] = $_GPC['__input']['from']; goto Yr0Dt; UN1HS: $params['fee'] = $_GPC['__input']['fee']; goto htWUl; T2Sao: if (!($_GPC['from'] == 'notify')) { goto znTg8; } goto wqU6A; Z_AeK: $params['fee'] = $_GPC['fee']; goto E3vnR; swSpM: } public function payResult($params) { goto hrJbh; wm4gs: GLfVW: goto HHIj4; dnhu1: $member = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_member') . ' WHERE pay_tid=\'' . $params['tid'] . '\''); goto CX7MQ; CX7MQ: if (!empty($member)) { goto wTPid; } goto BPj0c; EMr3J: $total_money = $recharge['money']; goto SZKk1; TUkFH: J6zFX: goto Q_8Dr; HOy2i: pmwPx: goto VztOW; WkrA5: goto EzTyW; goto JAUar; bb2Dw: pdo_update('navlange_pinche_travel', array("status" => "4"), array("id" => $member['travel_id'])); goto FqYBo; N4Pjg: message('支付成功！', $this->createMobileurl('my_travel'), 'success'); goto uiSnD; hrJbh: if ($params['from'] == 'notify') { goto q77uj; } goto Oq3wX; v3esa: goto CVhIH; goto qvuQh; TtQiS: $member = pdo_fetch('SELECT id,travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE pay_tid=\'' . $params['tid'] . '\''); goto cjvzt; JevX9: goto jBpod; goto G0lxz; HHIj4: xRjqR: goto v3esa; gtya0: pdo_update('navlange_pinche_credit3_record', array("status" => "1"), array("id" => $recharge['id'])); goto EMr3J; XgRdf: goto V_R3e; goto k6aAM; G0lxz: zPmuT: goto y9Pg9; JAUar: BT_jz: goto bb2Dw; OaqOB: if (!($params['result'] == 'success')) { goto pmwPx; } goto TtQiS; S_PlO: EzTyW: goto BsbtP; dSC3U: goto GLfVW; goto KV_yY; SZKk1: $mc_member = pdo_fetch('SELECT credit3 FROM ' . tablename('mc_members') . ' WHERE uid=' . $recharge['uid']); goto OYJhY; iURlh: bOMmf: goto dSC3U; n_2qZ: $this->pay_notify($member['id']); goto S_PlO; ZTduk: jBpod: goto iURlh; e_ieK: if ($params['result'] == 'success') { goto zPmuT; } goto Wb98Z; BsbtP: f0bNh: goto HOy2i; KV_yY: wTPid: goto GhBrs; bz9Wv: $this->confirm_arrival($member['id']); goto WkrA5; OYJhY: pdo_update('mc_members', array("credit3" => $mc_member['credit3'] + $total_money), array("uid" => $recharge['uid'])); goto IL6Gk; qvuQh: q77uj: goto OaqOB; FqYBo: pdo_update('navlange_pinche_member', array("status" => "4", "pay_mode" => "1", "payed_money" => $params['fee']), array("pay_tid" => $params['tid'])); goto Yru9y; y9Pg9: message('充值成功！', $this->createMobileurl('wallet'), 'success'); goto ZTduk; Q_8Dr: $pin = pdo_fetch('SELECT pin.id as id,pin.type as type FROM ' . tablename('navlange_pinche_pin') . ' AS pin LEFT JOIN ' . tablename('navlange_pinche_member') . ' AS member ON pin.id=member.pin_id WHERE member.id=' . $member['id']); goto Iy4qw; LV8Xt: pdo_update('navlange_pinche_member', array("pay_mode" => "1", "payed_money" => $params['fee']), array("pay_tid" => $params['tid'])); goto bz9Wv; GhBrs: if ($params['result'] == 'success') { goto lCF_R; } goto WaB7S; Oq3wX: if (!($params['from'] == 'return')) { goto xRjqR; } goto dnhu1; Wb98Z: message('充值失败！', '', 'error'); goto JevX9; cjvzt: if (!empty($member)) { goto J6zFX; } goto B5dpv; VztOW: CVhIH: goto a4kJQ; B5dpv: $recharge = pdo_fetch('SELECT id,uid,money FROM ' . tablename('navlange_pinche_credit3_record') . ' WHERE pay_tid=\'' . $params['tid'] . '\''); goto gtya0; Iy4qw: if ($pin['type'] != '2') { goto BT_jz; } goto LV8Xt; Yru9y: pdo_delete('navlange_pinche_member', array("travel_id" => $member['travel_id'], "status" => "0")); goto n_2qZ; WaB7S: message('支付失败！', '', 'error'); goto XgRdf; ISxnT: if (empty($recharge)) { goto bOMmf; } goto e_ieK; uiSnD: V_R3e: goto wm4gs; k6aAM: lCF_R: goto N4Pjg; BPj0c: $recharge = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_credit3_record') . ' WHERE pay_tid=\'' . $params['tid'] . '\''); goto ISxnT; IL6Gk: goto f0bNh; goto TUkFH; a4kJQ: } public function trans_status($status) { goto BhS0K; E4qU_: aR3FF: goto x3v13; WXgUm: sfqQt: goto VcAcy; RBkjH: Fv9Q1: goto nZLlv; x3v13: return '待接单'; goto L1DOy; VcAcy: return '待出行'; goto eQwNu; EimDd: return '出行中'; goto J9oDD; x0IRX: if ($status == '1') { goto yDSjH; } goto HZzmY; vv2kL: if ($status == '5') { goto PBndN; } goto U2PP9; Nc8rL: goto UlGIX; goto HjNUf; HjNUf: KnMQC: goto YiN_6; iq4aN: goto B1fWU; goto WXgUm; eQwNu: B1fWU: goto Nc8rL; tuu6w: return '已完成'; goto q2aO3; J9oDD: bkCLx: goto iq4aN; S1ppF: goto bkCLx; goto uXTVR; U2PP9: if ($status == '6') { goto zA59X; } goto So5tS; Bn3Bo: return '待确认'; goto awoth; QWCOL: return '退款/维权'; goto vDsEi; yzmm_: goto tXxXi; goto G1C65; Tq4l1: if ($status == '3') { goto sfqQt; } goto Zx3yh; xnHFZ: if ($status == '9') { goto QWG3l; } goto L7evg; HZzmY: if ($status == '2') { goto KnMQC; } goto Tq4l1; L1DOy: Uygah: goto LeO4r; b05Xg: yDSjH: goto Bn3Bo; aTGY1: goto Uygah; goto E4qU_; ykJ1B: goto gvXVH; goto uWezN; jVges: goto AF7EP; goto b05Xg; Zx3yh: if ($status == '4') { goto yhONu; } goto vv2kL; lTa28: PBndN: goto QWCOL; vDsEi: uNUHY: goto S1ppF; X_DwB: tXxXi: goto vN0R9; G1C65: zA59X: goto UkxsE; awoth: AF7EP: goto aTGY1; vN0R9: goto uNUHY; goto lTa28; uWezN: Ltjez: goto tuu6w; tDQO6: UlGIX: goto jVges; YiN_6: return '已取消'; goto tDQO6; Q2HtW: QWG3l: goto Y6vA4; Y6vA4: return '已过期'; goto S4Xxw; iOKWd: return '已关闭'; goto RBkjH; L7evg: if (!($status == '10')) { goto Fv9Q1; } goto iOKWd; UkxsE: return '已到达'; goto X_DwB; nZLlv: goto BA_sw; goto Q2HtW; uXTVR: yhONu: goto EimDd; So5tS: if ($status == '7') { goto Ltjez; } goto xnHFZ; S4Xxw: BA_sw: goto ykJ1B; BhS0K: if ($status == '0') { goto aR3FF; } goto x0IRX; q2aO3: gvXVH: goto yzmm_; LeO4r: } public function trans_pin_status($status) { goto SEWu5; t0IuF: if (!($status == '10')) { goto p7zu0; } goto dEwpg; dEwpg: return '已关闭'; goto B5zzg; CTlK7: if ($status == '2') { goto sh_fI; } goto cwWyN; uAe_p: return '待出行'; goto Y60qm; e2AFV: WRuEH: goto faSeS; rAA8n: goto WRuEH; goto u4a0y; cwWyN: if ($status == '3') { goto QWx5l; } goto mysk5; I6Lcs: V1IpP: goto mOPIF; SEWu5: if ($status == '0') { goto kJ3mF; } goto U7feM; mOPIF: goto kwjiR; goto BpZmq; FoRSG: return '已到达'; goto paNE4; faSeS: goto mlIcp; goto q3id4; q3id4: QWx5l: goto FoRSG; U7feM: if ($status == '1') { goto b_Lkw; } goto CTlK7; gTzMd: goto PMz1b; goto dYxz8; mysk5: if ($status == '9') { goto Sm6gu; } goto t0IuF; BpZmq: kJ3mF: goto uAe_p; yTpnP: return '已过期'; goto e2AFV; I8AO2: b_Lkw: goto jxupc; u4a0y: Sm6gu: goto yTpnP; URkgT: goto V1IpP; goto I8AO2; jxupc: return '已出发'; goto I6Lcs; paNE4: mlIcp: goto gTzMd; dYxz8: sh_fI: goto ZixBa; ZixBa: return '已取消'; goto A9poM; Y60qm: kwjiR: goto pApAb; A9poM: PMz1b: goto URkgT; B5zzg: p7zu0: goto rAA8n; pApAb: } public function trans_member_status($status) { goto CqrC3; I6aog: zO0w1: goto LG7j0; pnrJn: q2d1K: goto WNR2O; fMB5M: kRrPh: goto GhMOb; FOPI2: return '待出行'; goto QB6BI; VoFl2: return '退款/维权'; goto tpXRI; Ezr8o: return '出行中'; goto jQIWd; MlzEk: if ($status == '4') { goto dH_DQ; } goto nbAPN; LG7j0: return '待确认'; goto pnrJn; sN21p: dH_DQ: goto Ezr8o; Q3p7t: if ($status == '1') { goto zO0w1; } goto aFG7B; FdTZM: goto kRrPh; goto CX3Cc; JQpib: QQ1xJ: goto FOPI2; jAs02: return '已取消'; goto hVwDg; QB6BI: S1lTy: goto KB9vj; WmJCs: AJqP2: goto WVejn; WMzW3: iDZ0L: goto B4dMJ; CX3Cc: c4eS8: goto Xqlrj; JXeOB: goto S1lTy; goto JQpib; nbAPN: if ($status == '5') { goto l0cCI; } goto gBl6M; qmMLd: if ($status == '3') { goto QQ1xJ; } goto MlzEk; eWWjr: return '已关闭'; goto WMzW3; hVwDg: oUfP7: goto XfU3M; jQIWd: Xs7b3: goto JXeOB; AVzvt: return '已完成'; goto nnGms; TWDLD: goto Xs7b3; goto sN21p; aFG7B: if ($status == '2') { goto Qcw4p; } goto qmMLd; Xqlrj: return '已到达'; goto fMB5M; nnGms: ngWBF: goto FdTZM; WVejn: return '待车主确认'; goto ISdwk; tpXRI: IHCEn: goto TWDLD; CqrC3: if ($status == '0') { goto AJqP2; } goto Q3p7t; ISdwk: l3aQc: goto AnvSL; l2Bfc: if (!($status == '10')) { goto iDZ0L; } goto eWWjr; WNR2O: goto l3aQc; goto WmJCs; gBl6M: if ($status == '6') { goto c4eS8; } goto I0pWi; e5wMn: Qcw4p: goto jAs02; B4dMJ: goto ngWBF; goto OtzXZ; I0pWi: if ($status == '7') { goto a5xN_; } goto l2Bfc; xnT8Z: l0cCI: goto VoFl2; XfU3M: goto q2d1K; goto I6aog; OtzXZ: a5xN_: goto AVzvt; GhMOb: goto IHCEn; goto xnT8Z; KB9vj: goto oUfP7; goto e5wMn; AnvSL: } public function trans_travel_type($type) { goto XfoEg; VkGdG: jN6dq: goto TyBSN; zwctU: return '拼车'; goto MD9pJ; b0lcG: uEPu7: goto os7Xb; ybr6V: if ($type == '2') { goto BZ_un; } goto LVc8W; LVc8W: if ($type == '3') { goto vKObE; } goto HDpVl; LCUL1: return '班车专线'; goto j7dDR; MD9pJ: dMV8g: goto L01tn; j7dDR: MPtJ7: goto uWt_g; uWt_g: goto uEPu7; goto HKo2N; Pxf8t: JmXsS: goto LCUL1; TyBSN: goto MPtJ7; goto Pxf8t; HKo2N: vKObE: goto yW0c8; Uz1Iz: return '快车'; goto apexc; pDhFs: goto dMV8g; goto zrmAs; HDpVl: if ($type == '4') { goto JmXsS; } goto RG7PJ; XfoEg: if ($type == '1') { goto lemNQ; } goto ybr6V; os7Xb: goto FFNUH; goto Fhwxo; Fhwxo: BZ_un: goto Uz1Iz; bhgrj: return '拼货'; goto VkGdG; apexc: FFNUH: goto pDhFs; yW0c8: return '包车'; goto b0lcG; RG7PJ: if (!($type == '5')) { goto jN6dq; } goto bhgrj; zrmAs: lemNQ: goto zwctU; L01tn: } public function trans_goods_type($type) { goto aHxzU; U6byb: SWonJ: goto V6c_Q; dPsmq: return '其它设备'; goto Ma3dK; LUGiZ: fin1X: goto DAVUd; DAVUd: return '机台设备'; goto rAokr; zGbtC: nGQRO: goto CyJyk; c7SSu: if (!($type == '4')) { goto haCh2; } goto dPsmq; o92Nz: return '轻货'; goto U6byb; i8Poi: goto nGQRO; goto L54xy; LPF6S: if ($type == '2') { goto J1HTT; } goto SUHjc; L54xy: J1HTT: goto Tf6wB; CyJyk: goto SWonJ; goto r_I4e; KG51n: goto j4d6i; goto LUGiZ; Tf6wB: return '重货'; goto zGbtC; SUHjc: if ($type == '3') { goto fin1X; } goto c7SSu; Ma3dK: haCh2: goto KG51n; r_I4e: K6Kdt: goto o92Nz; rAokr: j4d6i: goto i8Poi; aHxzU: if ($type == '1') { goto K6Kdt; } goto LPF6S; V6c_Q: } public function trans_car_type($type) { goto zxXsZ; VHUzB: if ($type == '2') { goto wTuhX; } goto eGBWo; xWVm9: xfVXR: goto XiSkJ; XiSkJ: return '高栏'; goto sSSBQ; Py7xs: return '冷藏'; goto Y2kqU; ANlx2: mSWYv: goto P_hrd; P_hrd: goto Z5KYr; goto xWVm9; eSxsL: return '厢车'; goto mAqzA; sSSBQ: Z5KYr: goto PSNeB; Y2kqU: Zc_yS: goto vnFQK; eGBWo: if ($type == '3') { goto eIp5k; } goto e4zut; kSqnY: goto Zc_yS; goto h4XVn; vnFQK: goto mSWYv; goto kdU4W; mAqzA: ponNX: goto kSqnY; zxXsZ: if ($type == '1') { goto xfVXR; } goto VHUzB; n2S3k: return '平板'; goto ANlx2; h4XVn: eIp5k: goto Py7xs; e4zut: if (!($type == '4')) { goto ponNX; } goto eSxsL; kdU4W: wTuhX: goto n2S3k; PSNeB: } public function get_credit_level($score) { goto K0GTL; Jo9wD: r_ahe: goto n_5fG; q5Aiq: foreach ($level as $key => $value) { goto saCzW; saCzW: if (!($value['score'] <= $score)) { goto PUljl; } goto GQs3R; fSIL2: PUljl: goto yC_Xn; yC_Xn: LE7PO: goto iWO0k; GQs3R: return $value; goto fSIL2; iWO0k: } goto Jo9wD; CgZ7O: $level = pdo_fetchall('SELECT * FROM ' . tablename('navlange_pinche_credit_level') . ' WHERE uniacid=' . $_W['uniacid'] . ' ORDER BY score DESC'); goto q5Aiq; K0GTL: global $_W; goto CgZ7O; n_5fG: } public function mc_member_info() { goto TW5Rh; uorJs: RYbo5: goto kKoVs; MLZVh: $uni_mc_member = array(); goto gom4V; gom4V: $uni_mc_member['credit1'] = $mc_member['credit1']; goto IK6XG; kKoVs: AcvnA: goto CZ69g; IK6XG: $uni_mc_member['credit2'] = $mc_member['credit2']; goto UBcTC; g9QKS: foreach ($modules as $key => $value) { goto MRE1M; dv6BU: goto KpiXd; goto gr08q; C8KCs: gpUTw: goto dr4SE; GTye3: if (empty($value['config']['passive_link_uniacid'])) { goto LRgQI; } goto Cjm3B; mTBq_: LRgQI: goto OqyFH; gr08q: Bmxbx: goto GTye3; OqyFH: ixg5A: goto rnPAW; Cjm3B: $cur_mc_member = pdo_fetch('SELECT credit1,credit2 FROM ' . tablename('mc_members') . ' WHERE uniacid=' . $value['config']['passive_link_uniacid'] . ' AND mobile=\'' . $mc_member['mobile'] . '\''); goto F4f2W; rnPAW: KpiXd: goto GcH2C; hGoiU: unset($modules[$key]); goto NNBay; HNrZG: if (!($value['wxapp_support'] == MODULE_NONSUPPORT_WXAPP && $value['webapp_support'] == MODULE_NOSUPPORT_WEBAPP || !empty($value['issystem']))) { goto gpUTw; } goto hGoiU; pgZCC: $uni_mc_member['credit2'] = $uni_mc_member['credit2'] + $cur_mc_member['credit2']; goto mTBq_; MRE1M: if (!($key == 'navlange_pinche')) { goto ixg5A; } goto HNrZG; TUUcs: $uni_mc_member['credit2'] = $uni_mc_member['credit2'] + $cur_mc_member['credit2']; goto dv6BU; dr4SE: if (!(!empty($value['config']) && !empty($value['config']['link_uniacid']))) { goto Bmxbx; } goto u4Z3i; F4f2W: $uni_mc_member['credit1'] = $uni_mc_member['credit1'] + $cur_mc_member['credit1']; goto pgZCC; c07Vo: $uni_mc_member['credit1'] = $uni_mc_member['credit1'] + $cur_mc_member['credit1']; goto TUUcs; NNBay: goto KpiXd; goto C8KCs; u4Z3i: $cur_mc_member = pdo_fetch('SELECT credit1,credit2 FROM ' . tablename('mc_members') . ' WHERE uniacid=' . $value['config']['link_uniacid'] . ' AND mobile=\'' . $mc_member['mobile'] . '\''); goto c07Vo; GcH2C: } goto uorJs; TW5Rh: global $_W; goto oNwvL; oNwvL: $mc_member = pdo_fetch('SELECT mobile,credit1,credit2 FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto MLZVh; UBcTC: if (!($mc_member['mobile'] != '')) { goto AcvnA; } goto cn4G1; CZ69g: return $uni_mc_member; goto TjyHm; cn4G1: $modules = uni_modules(); goto g9QKS; TjyHm: } public function member_info($uid, $type) { goto CxPgM; CxPgM: $member = pdo_fetch('SELECT member.level_id as level_id,member.is_permanent as is_permanent,member.expire as expire FROM ' . tablename('navlange_member') . ' AS member LEFT JOIN ' . tablename('navlange_member_level') . ' AS level ON member.level_id=level.id WHERE member.uid=:uid AND level.type=:type', array(":uid" => $uid, ":type" => $type)); goto e8vlq; e8vlq: $level = pdo_get('navlange_member_level', array("id" => $member['level_id'])); goto QvefU; tRotx: zuWAW: goto X8tfj; yQIez: $info['level_id'] = $level['id']; goto DjJlF; mwZyz: $info['level'] = $level['name']; goto yQIez; QvefU: if (!empty($level)) { goto ktnyK; } goto E2o0A; unFdK: $info['is_permanent'] = $member['is_permanent']; goto Pw4cW; A3Ldy: goto zuWAW; goto up6bN; up6bN: ktnyK: goto mwZyz; Z_JTs: $info['discount'] = $level['discount']; goto unFdK; E2o0A: $info['level_id'] = 0; goto A3Ldy; X8tfj: return $info; goto BaMlF; Pw4cW: $info['expire'] = $member['expire']; goto tRotx; DjJlF: $info['type'] = $level['type']; goto Z_JTs; BaMlF: } public function get_travel_status($travel_id) { goto Ve0CB; JfJpl: if (!empty($member)) { goto bAtuF; } goto mAsRn; pr8zj: if ($travel['status'] == '0') { goto Seag2; } goto gNXef; ETvbM: bAtuF: goto JShrs; hqov3: Seag2: goto qwH_r; vEfFa: nFGjj: goto iutPK; iutPK: pDS_Z: goto loAoZ; mAsRn: return '0'; goto M9Tr_; qwH_r: $member = pdo_get('navlange_pinche_member', array("travel_id" => $travel_id)); goto JfJpl; JShrs: return '0.5'; goto vEfFa; xU0E8: goto pDS_Z; goto hqov3; Ve0CB: $travel = pdo_get('navlange_pinche_travel', array("id" => $travel_id)); goto pr8zj; M9Tr_: goto nFGjj; goto ETvbM; gNXef: return $travel['status']; goto xU0E8; loAoZ: } public function doWebSearch_member() { goto xGxGo; xGxGo: global $_W, $_GPC; goto ZxH_6; nTgY0: message(error(0, $member), '', 'ajax'); goto yvmMu; ZxH_6: $member = pdo_fetch('SELECT uid,nickname,avatar,realname,mobile FROM ' . tablename('mc_members') . ' WHERE (nickname LIKE \'%' . $_GPC['search_key'] . '%\'' . ' OR realname LIKE \'%' . $_GPC['search_key'] . '%\'' . ' OR mobile LIKE \'%' . $_GPC['search_key'] . '%\') AND uniacid=' . $_W['uniacid']); goto nTgY0; yvmMu: } public function doMobileGet_line() { goto konqW; lRgE3: if (!array_key_exists('departure_station', $_GPC)) { goto Mx2zC; } goto D2fJQ; CaYxv: if (!array_key_exists('terminal_station', $_GPC)) { goto mPFhY; } goto rdHtD; fMpjn: $line_info = array(); goto So0w6; konqW: global $_W, $_GPC; goto xcrqk; rdHtD: $sql .= ' AND terminal_station=\'' . $_GPC['terminal_station'] . '\''; goto hmc4Y; BkSY3: message(error(0, $line_info), '', 'ajax'); goto HkPml; hmc4Y: mPFhY: goto m1oa_; D2fJQ: $sql .= ' AND departure_station=\'' . $_GPC['departure_station'] . '\''; goto as5wt; as5wt: Mx2zC: goto CaYxv; So0w6: foreach ($line as $key => $value) { goto Jogmd; fPniT: $data['terminal_station'] = pdo_fetchcolumn('SELECT name FROM ' . tablename('navlange_pinche_station') . ' WHERE id=' . $value['terminal_station']); goto q5SGj; Fbypq: TPt3c: goto uMlhr; Jogmd: $data = $value; goto ElFH4; ElFH4: $data['departure_station'] = pdo_fetchcolumn('SELECT name FROM ' . tablename('navlange_pinche_station') . ' WHERE id=' . $value['departure_station']); goto fPniT; q5SGj: array_push($line_info, $data); goto Fbypq; uMlhr: } goto GBIYd; GBIYd: Fos9S: goto BkSY3; m1oa_: $line = pdo_fetchall($sql); goto fMpjn; xcrqk: $sql = 'SELECT * FROM ' . tablename('navlange_pinche_line') . ' WHERE uniacid=' . $_W['uniacid']; goto lRgE3; HkPml: } public function doMobileGet_pin_releasable() { goto Hi8na; pMzi4: $pin = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_pin') . ' WHERE type=\'1\' AND openid=\'' . $_W['openid'] . '\' AND (status=\'0\' OR status=\'1\') AND departure_time>' . TIMESTAMP); goto FA3JC; oufuC: message(error(0, ''), '', 'ajax'); goto WejbH; W3Dql: nDgp1: goto oufuC; w4ffk: osIQy: goto W3Dql; Hi8na: global $_W; goto vPobP; t7iF0: if (!($conf['pin_release_multi_on'] == '0')) { goto nDgp1; } goto pMzi4; vPobP: $conf = pdo_fetch('SELECT pin_release_multi_on FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto t7iF0; ihtEt: message(error(1, ''), '', 'ajax'); goto w4ffk; FA3JC: if (empty($pin)) { goto osIQy; } goto ihtEt; WejbH: } public function doMobileGet_cargo_releasable() { goto pVIi3; tX8QL: if (!empty($pin)) { goto lOQV3; } goto Wljs4; tdN6X: $pin = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_pin') . ' WHERE type=\'4\' AND openid=\'' . $_W['openid'] . '\' AND (status=\'0\' OR status=\'1\') AND departure_time>' . TIMESTAMP); goto tX8QL; K8FmN: lOQV3: goto EUx8Y; pVIi3: global $_W; goto tdN6X; dzLpY: goto AWz6T; goto K8FmN; Wljs4: message(error(0, ''), '', 'ajax'); goto dzLpY; EUx8Y: message(error(1, ''), '', 'ajax'); goto IBgw9; IBgw9: AWz6T: goto zaO88; zaO88: } public function confirm_arrival($member_id) { goto fBbGu; NHwb9: goto Dgf50; goto J0ZXz; do5pw: goto cnh1w; goto DD09m; AgiVX: $award_record['mode'] = '1'; goto XAbgm; l0AGG: $award_record['status'] = '1'; goto Y3our; ZrcPi: j2xVh: goto do5pw; z_3KG: if (!($owner['inviter_uid'] > 0)) { goto r6Qx5; } goto He9oK; wPGkU: $award_record['uid'] = $owner_uid; goto v9GHZ; SCOUw: $award_record['status'] = '1'; goto IIe2s; Dp2Cu: if (!($member['pay_mode'] != '9')) { goto BSA7d; } goto s0yaG; ES5cc: $award_record['mode'] = '2'; goto WZpnA; DiIsQ: $owner_info['total_income'] = $owner['total_income'] + $owner_income; goto AclDa; VZX_Y: $award_income = $marketing_conf['owner_fixed_award_money']; goto CkaEo; XgtUG: $award_record['generate_time'] = TIMESTAMP; goto wpU5Y; DS0_s: $item['uid'] = $owner_uid; goto TUrIs; WZpnA: $award_record['desc'] = '司机奖励：' . $award_income; goto IeH79; tKzoI: if (!($marketing_conf['owner_award_mode'] == '2')) { goto j2xVh; } goto Ndd7Q; g0NK4: Dgf50: goto e_7z_; SRwKO: if (!($marketing_conf['fx_on'] == '1')) { goto lUCGK; } goto lZ5JA; Q77E0: $new_member['credit4'] = $mc_member['credit4'] + $partner_award_money; goto aYwmA; VoR1l: $mc_member = pdo_fetch('SELECT credit4 FROM ' . tablename('mc_members') . ' WHERE uid=' . $owner_uid); goto mIZbl; laCp6: $award_record['money'] = $award_income; goto IE0qE; XvaXA: $award_record = array(); goto XgtUG; TmPrO: $new_member['credit4'] = $mc_member['credit4'] + $marketing_conf['partner_award_money']; goto SvxdG; e_7z_: if (!($marketing_conf['invite_award_mode'] == '1' && $marketing_conf['inviter_award_ratio_from_order'] > 0 && $member['payed_money'] > 0)) { goto ql0dj; } goto fXoeW; hV9Bz: $mc_member = pdo_fetch('SELECT credit4 FROM ' . tablename('mc_members') . ' WHERE uid=' . $partner['pre']); goto TmPrO; Iisig: $award_record['uniacid'] = $_W['uniacid']; goto AgiVX; U6nk9: if ($marketing_conf['partner_award_mode'] == '1' && $marketing_conf['partner_award_money'] > 0) { goto yeDSK; } goto gkU_B; SA0Oy: $award_record['generate_time'] = TIMESTAMP; goto aQVP6; i1m9b: pdo_update('navlange_pinche_travel', array("status" => "7"), array("id" => $member['travel_id'])); goto jm4wb; l53RD: wMW2t: goto U6nk9; Q3S_w: $award_record['generate_time'] = TIMESTAMP; goto Iisig; ZzCr3: pdo_insert('navlange_pinche_integral_record', $item); goto l53RD; bm1p3: $award_record['mode'] = '1'; goto daKWj; odVXu: $award_record = array(); goto AAAXH; HdWwx: $mc_member = pdo_fetch('SELECT credit3 FROM ' . tablename('mc_members') . ' WHERE uid=' . $owner_uid); goto CAhsq; gkU_B: if (!($marketing_conf['partner_award_mode'] == '2' && $marketing_conf['partner_award_ratio'] > 0)) { goto SmpU5; } goto zEDR_; i8OjE: pdo_insert('navlange_pinche_credit4_record', $award_record); goto wA3uH; maHUm: $award_record['next'] = $owner_uid; goto S89ak; wA3uH: $mc_member = pdo_fetch('SELECT credit4 FROM ' . tablename('mc_members') . ' WHERE uid=' . $owner['inviter_uid']); goto U8wPe; DD09m: Epbdg: goto VZX_Y; AclDa: pdo_update('navlange_pinche_owner', $owner_info, array("uid" => $owner_uid)); goto HdWwx; mIZbl: $new_member['credit4'] = $mc_member['credit4'] + $award_income; goto Rw7wS; fXoeW: $invite_award_income = $member['payed_money'] * $marketing_conf['inviter_award_ratio_from_order'] / 100; goto z_3KG; XAbgm: $award_record['desc'] = '合伙人邀请奖励：' . $partner_award_money; goto APujj; mBGCX: $award_record['pre'] = $partner['pre']; goto maHUm; Ndd7Q: $award_income = $marketing_conf['owner_award_ratio'] * $member['payed_money'] / 100; goto ZrcPi; SNppP: $owner_income = $member['payed_money'] * (100 - $conf['platform_deduct']) / 100; goto DiIsQ; Qlmn6: $item['pin_id'] = $member['pin_id']; goto ZzCr3; xA4Bz: ql0dj: goto XPIfO; X_W05: $fx_params['consumption_money'] = $member['payed_money']; goto thZ33; IYCZ9: return 0; goto z9wuL; Y3our: $award_record['money'] = $marketing_conf['partner_award_money']; goto mBGCX; APujj: $award_record['status'] = '1'; goto oN6X8; SUJ2e: $this->httpPost(murl('entry', array("m" => "navlange_fx", "do" => "deduct", "uid" => $member['uid'], "money" => $member['payed_money']), true, true), $fx_params); goto yfFxV; vTEVE: $mc_member = pdo_fetch('SELECT credit4 FROM ' . tablename('mc_members') . ' WHERE uid=' . $partner['pre']); goto Q77E0; oN6X8: $award_record['money'] = $partner_award_money; goto Cw6AY; Cw6AY: $award_record['pre'] = $partner['pre']; goto u6r8g; FznwT: $award_record['openid'] = $inviter['openid']; goto axFP2; IE0qE: $award_record['openid'] = $owner['openid']; goto wPGkU; qESXw: SmpU5: goto NHwb9; IeH79: $award_record['status'] = '1'; goto laCp6; XtC51: if (!($exists_record < $marketing_conf['owner_pin_success_integral_per_day'] && $marketing_conf['owner_pin_success_integral'] > 0)) { goto wMW2t; } goto d0PRV; fBbGu: global $_W; goto x71Qx; LDBWJ: $item['time'] = TIMESTAMP; goto Qlmn6; x71Qx: $conf = pdo_fetch('SELECT platform_deduct FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto qlQgm; X6stl: pdo_update('mc_members', $new_member, array("uid" => $owner['inviter_uid'])); goto CP4z4; daKWj: $award_record['desc'] = '合伙人邀请奖励：' . $marketing_conf['partner_award_money']; goto l0AGG; kK5EL: $owner = pdo_fetch('SELECT openid,total_income,inviter_uid FROM ' . tablename('navlange_pinche_owner') . ' WHERE uid=' . $owner_uid); goto Dp2Cu; SKzPX: $item['uniacid'] = $_W['uniacid']; goto DS0_s; CWHa3: if (!($award_income > 0)) { goto vYlwD; } goto XvaXA; S89ak: pdo_insert('navlange_partner_award_record', $award_record); goto hV9Bz; aciXT: pdo_update('mc_members', array("credit1" => $mc_member['credit1'] + $marketing_conf['owner_pin_success_integral']), array("uid" => $owner_uid)); goto EX_rc; tYwh6: if (empty($partner)) { goto ImRbG; } goto SA0Oy; XPIfO: if ($marketing_conf['owner_award_mode'] == '1') { goto Epbdg; } goto tKzoI; qlQgm: $marketing_conf = pdo_fetch('SELECT owner_pin_success_integral,owner_pin_success_integral_per_day,fx_on,owner_award_mode,owner_fixed_award_money,owner_award_ratio,invite_award_mode,inviter_award_ratio_from_order,partner_award_mode,partner_award_money,partner_award_ratio FROM ' . tablename('navlange_pinche_marketing_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto wtueV; U8wPe: $new_member['credit4'] = $mc_member['credit4'] + $invite_award_income; goto X6stl; CAhsq: $mc_member['credit3'] = $mc_member['credit3'] + $owner_income; goto uyvRF; sAbGS: $award_record['desc'] = '司机邀请奖励：' . $invite_award_income; goto SCOUw; lZ5JA: $fx_params['type'] = '0'; goto X_W05; kLu46: $item['integral'] = $marketing_conf['owner_pin_success_integral']; goto LDBWJ; aYwmA: pdo_update('mc_members', $new_member, array("uid" => $partner['pre'])); goto tj_Ak; G4kzo: $partner = pdo_fetch('SELECT pre FROM ' . tablename('navlange_partner_core') . ' WHERE next=' . $owner_uid); goto tYwh6; oqGAK: $owner_uid = pdo_fetchcolumn('SELECT uid FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $member['pin_id']); goto kK5EL; aQVP6: $award_record['uniacid'] = $_W['uniacid']; goto bm1p3; SEFcD: $exists_record = pdo_fetchcolumn('SELECT COUNT(id) FROM ' . tablename('navlange_pinche_integral_record') . ' WHERE type=\'1\' AND uid=' . $owner_uid . ' AND time>=' . strtotime(date('Y-m-d', TIMESTAMP)) . ' AND time<' . (strtotime(date('Y-m-d', TIMESTAMP)) + 24 * 60 * 60) . ' AND pin_id=' . $member['pin_id']); goto XtC51; TUrIs: $item['type'] = '1'; goto kLu46; u6r8g: $award_record['next'] = $owner_uid; goto zX55S; s0yaG: $owner_info = array(); goto SNppP; RscKl: $award_record['mode'] = '3'; goto sAbGS; axFP2: $award_record['uid'] = $owner['inviter_uid']; goto i8OjE; pyuTO: $fx_params['member_level'] = ''; goto GDhrM; He9oK: $inviter = pdo_fetch('SELECT openid FROM ' . tablename('navlange_pinche_owner') . ' WHERE uid=' . $owner['inviter_uid']); goto odVXu; d0PRV: $mc_member = pdo_fetch('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=' . $owner_uid); goto aciXT; zEDR_: $partner = pdo_fetch('SELECT pre FROM ' . tablename('navlange_partner_core') . ' WHERE next=' . $owner_uid); goto WOs8l; thZ33: $fx_params['member_level_id'] = 0; goto pyuTO; v9GHZ: pdo_insert('navlange_pinche_credit4_record', $award_record); goto VoR1l; tj_Ak: oXKAk: goto qESXw; J0ZXz: yeDSK: goto G4kzo; uyvRF: pdo_update('mc_members', $mc_member, array("uid" => $owner_uid)); goto LsVUq; SvxdG: pdo_update('mc_members', $new_member, array("uid" => $partner['pre'])); goto O8qPc; WOs8l: $partner_award_money = $marketing_conf['partner_award_ratio'] * $member['payed_money'] / 100; goto s7uj_; Rw7wS: pdo_update('mc_members', $new_member, array("uid" => $owner_uid)); goto RGvuj; AAAXH: $award_record['generate_time'] = TIMESTAMP; goto QhdwO; LsVUq: BSA7d: goto SEFcD; wtueV: $member = pdo_fetch('SELECT uid,sn,pin_id,travel_id,payed_money,pay_mode FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto i1m9b; wpU5Y: $award_record['uniacid'] = $_W['uniacid']; goto ES5cc; RGvuj: vYlwD: goto SRwKO; QhdwO: $award_record['uniacid'] = $_W['uniacid']; goto RscKl; EX_rc: $item = array(); goto SKzPX; N2vWx: $fx_params['order_sn'] = $member['sn']; goto SUJ2e; O8qPc: ImRbG: goto g0NK4; CP4z4: r6Qx5: goto xA4Bz; yfFxV: lUCGK: goto IYCZ9; GDhrM: $fx_params['desc'] = '拼车消费：' . $member['payed_money']; goto N2vWx; jm4wb: pdo_update('navlange_pinche_member', array("status" => "7"), array("id" => $member_id)); goto oqGAK; CkaEo: cnh1w: goto CWHa3; zX55S: pdo_insert('navlange_partner_award_record', $award_record); goto vTEVE; s7uj_: if (!(!empty($partner) && $partner_award_money > 0)) { goto oXKAk; } goto Q3S_w; IIe2s: $award_record['money'] = $invite_award_income; goto FznwT; z9wuL: } public function doMobileGet_travel_pin() { goto Z0jzB; qXG9b: if (!empty($pin)) { goto g4K11; } goto UAqFV; N8QGn: WgsHg: goto n0p4G; btVtH: message(error(0, $pin), '', 'ajax'); goto N8QGn; F6236: $pin = pdo_fetchcolumn('SELECT pin_id FROM ' . tablename('navlange_pinche_member') . ' WHERE travel_id=' . $_GPC['id'] . ' AND uniacid=' . $_W['uniacid']); goto qXG9b; inLWT: goto WgsHg; goto o50e5; UAqFV: message(error(1, ''), '', 'ajax'); goto inLWT; Z0jzB: global $_W, $_GPC; goto F6236; o50e5: g4K11: goto btVtH; n0p4G: } public function register_passenger($uid, $openid) { goto TXdRM; TXdRM: global $_W; goto mNmm1; KwvQH: $passenger['credit_score'] = pdo_fetchcolumn('SELECT client_default_credit_score FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto CG9JW; uVzvt: pdo_update('navlange_pinche_platform', $platform_info, array("uniacid" => $_W['uniacid'])); goto aujaf; V_3HZ: $passenger['register_time'] = TIMESTAMP; goto KwvQH; CG9JW: $passenger['uniacid'] = $_W['uniacid']; goto wRrlI; mNmm1: $passenger['uid'] = $uid; goto o5Mo2; o5Mo2: $passenger['openid'] = $openid; goto V_3HZ; qqniS: $platform = pdo_fetch('SELECT passenger_amount FROM ' . tablename('navlange_pinche_platform') . ' WHERE uniacid=' . $_W['uniacid']); goto z5Umz; wRrlI: pdo_insert('navlange_pinche_client', $passenger); goto qqniS; z5Umz: $platform_info['passenger_amount'] = $platform['passenger_amount'] + 1; goto uVzvt; aujaf: } public function doMobileSwitch_working_status() { goto A9AcC; aazsp: message(error(0, ''), '', 'ajax'); goto Mn9OM; U1RIN: pdo_update('navlange_pinche_owner', array("working_on" => $_GPC['status']), array("uid" => $_W['member']['uid'])); goto aazsp; A9AcC: global $_W, $_GPC; goto U1RIN; Mn9OM: } public function get_pin_member_info($member_id) { $member = pdo_fetch('SELECT member.id as id,member.uid as uid,member.pin_id as pin_id,member.status as status,member.owner_comming_to_departure_station as owner_comming_to_departure_station,member.owner_arrived_departure_station as owner_arrived_departure_station,member.owner_arrived_departure_station_time as owner_arrived_departure_station_time,member.price as price,travel.departure_city as departure_city,travel.departure_station as departure_station,travel.terminal_city as terminal_city,travel.terminal_station as terminal_station,travel.departure_time as departure_time,travel.mobile as mobile,travel.lng as lng,travel.lat as lat,travel.terminal_lng as terminal_lng,travel.terminal_lat as terminal_lat,travel.amount as amount,member.cancel_reason as cancel_reason,member.owner_cancel_reason as owner_cancel_reason FROM ' . tablename('navlange_pinche_member') . ' AS member LEFT JOIN ' . tablename('navlange_pinche_travel') . ' AS travel ON member.travel_id=travel.id WHERE member.id=' . $member_id); return $member; } public function join_pin_check($pin_id, $amount) { goto hXJUj; fKDav: $pin = pdo_fetch('SELECT uid,left_amount FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $pin_id); goto G3Zk0; lV1WY: return $status; goto rqiZE; vRAqP: rXFx2: goto fUnV1; RaHNh: Sw6GA: goto koGWJ; a63z5: C8Hs0: goto lwfDJ; vZhW7: $status = '0'; goto k2Ah1; TkEWb: $status = '1'; goto Q8pPw; JkbtR: $status = '7'; goto lV1WY; hXJUj: global $_W; goto vZhW7; Q8pPw: nd26s: goto W078v; TI7ns: BYrrS: goto CzPt6; CzPt6: $is_member = pdo_fetch('SELECT member.* FROM ' . tablename('navlange_pinche_member') . ' AS member LEFT JOIN ' . tablename('navlange_pinche_travel') . ' AS travel ON member.travel_id=travel.id WHERE travel.uid=\'' . $_W['member']['uid'] . '\' AND member.pin_id=' . $pin_id); goto ydpgw; mYlGD: if (!($amount > $pin['left_amount'])) { goto rtUhf; } goto qqHGx; kK8xI: $status = '3'; goto TI7ns; jX3ed: $status = '5'; goto vRAqP; G3Zk0: $conf = pdo_fetch('SELECT need_travel_before_pin_on,passenger_mobile_by_force FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto IpW7w; Xojdd: $travel = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_travel') . ' WHERE uid=' . $_W['member']['uid'] . ' AND (status=\'0\' OR status=\'1\')'); goto jApCm; qa9uU: if (!($mc_member['mobile'] == '')) { goto kolxy; } goto JkbtR; Hh0rN: OLy1L: goto TkEWb; BL1uq: if ($wx_member['mobile']) { goto Sw6GA; } goto ajuWf; ajuWf: $status = '6'; goto iYrCu; rqiZE: kolxy: goto fKDav; RxkGC: if (!($pin['uid'] == $_W['member']['uid'])) { goto BYrrS; } goto kK8xI; iYrCu: return $status; goto RaHNh; g_xgN: $wx_member = pdo_fetch('SELECT mobile FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto BL1uq; omgbS: rtUhf: goto KrQCo; F7nb7: if ($pin['left_amount'] <= 0) { goto C8Hs0; } goto mYlGD; W078v: return $status; goto EJ9oi; DrK4t: ryBHB: goto J24Gy; k2Ah1: $mc_member = pdo_fetch('SELECT mobile FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto qa9uU; fUnV1: Sm5Zr: goto RxkGC; koGWJ: vNNaV: goto HWxtW; ydpgw: if (!empty($is_member)) { goto OLy1L; } goto F7nb7; jApCm: if (!empty($travel)) { goto rXFx2; } goto jX3ed; HWxtW: if (!($conf['need_travel_before_pin_on'] == '1')) { goto Sm5Zr; } goto Xojdd; lwfDJ: $status = '4'; goto DrK4t; J24Gy: goto nd26s; goto Hh0rN; KrQCo: goto ryBHB; goto a63z5; qqHGx: $status = '2'; goto omgbS; IpW7w: if (!($conf['passenger_mobile_by_force'] == '1')) { goto vNNaV; } goto g_xgN; EJ9oi: } public function doMobileJoin_pin_check() { goto G0nU3; rGK0T: message(error($status, $travel), '', 'ajax'); goto JYXaO; NBwAA: $conf = pdo_fetch('SELECT need_travel_before_pin_on FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto PPS6_; jsedc: $status = $this->join_pin_check($_GPC['id'], 1); goto NBwAA; G0nU3: global $_W, $_GPC; goto jsedc; PPS6_: $travel = pdo_fetch('SELECT id,departure_station,terminal_station,expected_price,departure_time,amount FROM ' . tablename('navlange_pinche_travel') . ' WHERE uid=' . $_W['member']['uid'] . ' AND (status=\'0\' OR status=\'1\')'); goto rGK0T; JYXaO: } public function travel_release_check() { goto H3_df; tI6Oc: return '0'; goto awYTQ; ipczM: Ul42o: goto RlY_O; RlY_O: return '0'; goto A2z4a; OdQKQ: $pin = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_pin') . ' WHERE uid=' . $_W['member']['uid'] . ' AND type=\'1\' AND (status=\'0\' || status=\'1\')' . ' AND departure_time>' . TIMESTAMP); goto VhcM7; zZV7h: $travel = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_travel') . ' WHERE uid=' . $_W['member']['uid'] . ' AND (status=\'0\' OR status=\'1\' OR status=\'3\' OR status=\'4\') AND departure_time>' . TIMESTAMP); goto L52bM; t5H9R: return '1'; goto uX9bI; L52bM: if (empty($travel)) { goto iA0CA; } goto t5H9R; ps7n6: if (!($conf['multi_pin_travel_release_on'] == '0')) { goto voiS1; } goto zZV7h; R8B20: return '2'; goto ipczM; A2z4a: voiS1: goto tI6Oc; VhcM7: if (empty($pin)) { goto Ul42o; } goto R8B20; H3_df: global $_W; goto yoUvn; uX9bI: iA0CA: goto OdQKQ; yoUvn: $conf = pdo_fetch('SELECT multi_pin_travel_release_on FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto ps7n6; awYTQ: } public function travel_join_pin_success($travel_id, $pin_id) { goto K7Ssx; JTLud: pdo_update('navlange_pinche_pin', $data, array("id" => $pin_id)); goto ggXVp; txxa5: $pin = pdo_fetch('SELECT pined_amount,left_amount FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $pin_id); goto BPRrh; wxAyI: $data['left_amount'] = $pin['left_amount'] - $travel['amount']; goto JTLud; BPRrh: $data['pined_amount'] = $pin['pined_amount'] + $travel['amount']; goto wxAyI; K7Ssx: $travel = pdo_fetch('SELECT amount FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $travel_id); goto txxa5; ggXVp: } public function cancel_member_success($member_id) { goto hsgUk; Oy4n7: $pin_info['left_amount'] = $pin['left_amount'] + $member['passenger_amount']; goto qOOUn; ZYDZ2: $pin_info['pined_amount'] = $pin['pined_amount'] - $member['passenger_amount']; goto Oy4n7; rAkT3: $pin = pdo_fetch('SELECT pined_amount,left_amount FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $member['pin_id']); goto ZYDZ2; hsgUk: $member = pdo_fetch('SELECT pin_id,passenger_amount FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto rAkT3; qOOUn: pdo_update('navlange_pinche_pin', $pin_info, array("id" => $member['pin_id'])); goto aXPjb; aXPjb: } public function doMobileGo_to_departure_station() { goto o0_Vn; mbd2y: $member = pdo_fetch('SELECT pin_id,travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['member_id']); goto d4jSZ; o0_Vn: global $_GPC; goto mbd2y; d4jSZ: pdo_update('navlange_pinche_travel', array("owner_comming_to_departure_station" => "1"), array("id" => $member['travel_id'])); goto mGxt1; jrIpo: pdo_update('navlange_pinche_pin', array("status" => "1"), array("id" => $member['pin_id'])); goto dTWYV; V4058: $this->go_to_passenger_departure_station_notify($_GPC['member_id']); goto ZitQ9; WYAbd: $pin = pdo_fetch('SELECT status FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $member['pin_id']); goto pWu2S; pWu2S: if (!($pin['status'] == '0')) { goto R1stT; } goto jrIpo; mGxt1: pdo_update('navlange_pinche_member', array("owner_comming_to_departure_station" => "1"), array("id" => $_GPC['member_id'])); goto WYAbd; dTWYV: R1stT: goto V4058; ZitQ9: message(error(0, ''), '', 'ajax'); goto xS6uw; xS6uw: } public function doMobileArrive_departure_station() { goto NQ1xz; AxCJC: $this->arrive_passenger_departure_station_notify($_GPC['member_id']); goto BsdmZ; de9jC: $travel_id = pdo_fetchcolumn('SELECT travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['member_id']); goto AJLSr; AJLSr: pdo_update('navlange_pinche_travel', array("owner_arrived_departure_station" => "1"), array("id" => $travel_id)); goto zVVMG; BsdmZ: message(error(0, ''), '', 'ajax'); goto u9X3s; zVVMG: pdo_update('navlange_pinche_member', array("owner_arrived_departure_station" => "1", "owner_arrived_departure_station_time" => TIMESTAMP), array("id" => $_GPC['member_id'])); goto AxCJC; NQ1xz: global $_GPC; goto de9jC; u9X3s: } public function doMobileGet_pin_info() { goto fCL9Y; hnY9F: message(error(0, $pin), '', 'ajax'); goto VsBi3; fCL9Y: global $_GPC; goto QLhBx; QLhBx: $pin = pdo_fetch('SELECT pined_amount FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $_GPC['id']); goto hnY9F; VsBi3: } public function doMobileTravel_release_pin_submit() { goto buUD1; zN53x: $travel['boarding_place'] = $_GPC['departure_station']; goto dFRD1; tGD1Z: $travel['status'] = '0'; goto Kivi1; FElRr: $travel['lat'] = $_GPC['lat']; goto Dr128; RRwHX: R1LJv: goto RVjnc; Tja0X: $travel['departure_station'] = $_GPC['departure_station']; goto Ju4Up; gkBOl: $travel_id = pdo_insertid(); goto Z5O_7; mrZQF: $travel['terminal_station'] = $_GPC['terminal_station']; goto ObrgJ; Z5O_7: $this->pin_passenger_release_travel_success($travel_id); goto MJv55; tRuoB: $this->register_passenger($_W['member']['uid'], $_W['openid']); goto RRwHX; PdHYc: pdo_insert('navlange_pinche_travel', $travel); goto gkBOl; TI_Jc: message(error($status, ''), '', 'ajax'); goto N2KbN; IBygC: $client['uid'] = $_W['member']['uid']; goto jo0qD; Dr128: $travel['terminal_lng'] = $_GPC['terminal_lng']; goto txNDX; hpxev: $travel['departure_city'] = $_GPC['departure_city']; goto SAa7o; uKo6g: $travel['expected_price'] = $_GPC['expected_price']; goto tGD1Z; Ju4Up: $travel['terminal_city'] = $_GPC['terminal_city']; goto CsMZT; CsMZT: $travel['terminal_district'] = $_GPC['terminal_district']; goto mrZQF; N2KbN: TlDac: goto YjxXa; h62lm: $travel['name'] = $wx_member['realname']; goto hLckQ; cRrBX: $travel['note'] = $_GPC['note']; goto PdHYc; hLckQ: $travel['mobile'] = $wx_member['mobile']; goto NBALj; NBALj: $travel['amount'] = $_GPC['amount']; goto zN53x; RVjnc: $status = $this->travel_release_check(); goto U0Ud8; MJv55: message(error(0, ''), '', 'ajax'); goto wwuNQ; Kivi1: $travel['type'] = '1'; goto cRrBX; ha2tJ: $travel['uid'] = $_W['member']['uid']; goto pJS82; tL6pr: $travel['uniacid'] = $_W['uniacid']; goto tvPoS; XgUux: $client['uniacid'] = $_W['uniacid']; goto IBygC; ObrgJ: $travel['departure_time'] = strtotime($_GPC['departure_time']); goto h62lm; SAa7o: $travel['departure_district'] = $_GPC['departure_district']; goto Tja0X; jo0qD: $is_exist = pdo_get('navlange_pinche_client', $client); goto uhP9N; YjxXa: $wx_member = pdo_fetch('SELECT realname,mobile FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto hpxev; pJS82: $travel['openid'] = $_W['openid']; goto tL6pr; buUD1: global $_W, $_GPC; goto XgUux; txNDX: $travel['terminal_lat'] = $_GPC['terminal_lat']; goto ha2tJ; U0Ud8: if (!($status != '0')) { goto TlDac; } goto TI_Jc; uhP9N: if (!empty($is_exist)) { goto R1LJv; } goto tRuoB; dFRD1: $travel['lng'] = $_GPC['lng']; goto FElRr; tvPoS: $travel['release_time'] = TIMESTAMP; goto uKo6g; wwuNQ: } public function doMobileTravel_edit_submit() { goto GEXwU; ee5jl: message(error(0, ''), '', 'ajax'); goto MLlI7; GEXwU: global $_GPC; goto hHjHd; mbDHi: $travel['expected_price'] = $_GPC['expected_price']; goto ZE1hV; ZE1hV: pdo_update('navlange_pinche_travel', $travel, array("id" => $_GPC['id'])); goto ee5jl; AwhNt: $travel['amount'] = $_GPC['amount']; goto mbDHi; hHjHd: $travel['departure_time'] = strtotime($_GPC['departure_time']); goto AwhNt; MLlI7: } public function doMobileJoin_pin_submit() { goto je7JI; lVehX: $pin_sn_suffix = '00' . $pin_count; goto iBP96; KfoqD: $pay_tid_suffix = '00' . $pay_count; goto SkUNo; j2J7v: $new_member['uniacid'] = $_W['uniacid']; goto oHl7X; EyQUP: $pin_sn_suffix = '0000' . $pin_count; goto jIDGS; ZCrw6: goto jZPN7; goto kMWbP; olZLv: goto y1jCe; goto C8mSx; SkUNo: Vn7Vc: goto SqkEc; Mxf20: $new_travel['lng'] = $_GPC['lng']; goto WvgnL; KA2B0: $new_member['sn'] = $sn_prefix . $pin_sn_suffix; goto ecVac; Tqerr: if ($pay_count < 10) { goto zjiht; } goto vv9ju; Tmuiy: $pin_sn_suffix = '000' . $pin_count; goto JdLkl; pOQKc: $pin = pdo_get('navlange_pinche_pin', array("id" => $_GPC['id'])); goto txWV7; ib8Fn: $new_travel['departure_station'] = $pin['departure_station']; goto TWN8z; je7JI: global $_W, $_GPC; goto QZ0jT; z8Iy3: if ($_GPC['travel_id'] > 0) { goto fztCP; } goto UaEbV; cfOiq: $travel_id = pdo_insertid('navlange_pinche_travel'); goto MP1Vt; uYXbV: $pay_tid_suffix = '000' . $pay_count; goto UUl0e; TWN8z: $new_travel['departure_city'] = $pin['departure_city']; goto kXESm; SPeFx: message(error($status, ''), '', 'ajax'); goto uTKHq; mzsth: $travel = pdo_fetch('SELECT uid,amount FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $_GPC['travel_id']); goto Rnx9J; zLIr5: goto igdnY; goto tP7Bc; PTwu2: if ($pay_count < 1000) { goto YkgAF; } goto XeEOA; Fcupf: xk3YP: goto ckW17; C8mSx: zjiht: goto a1BNA; kMWbP: X2r8T: goto Tmuiy; ZbaDL: $this->register_passenger($_W['member']['uid'], $_W['openid']); goto F4_Uj; a1BNA: $pay_tid_suffix = '0000' . $pay_count; goto tU3ge; qsC_N: message(error($status, $travel_id), '', 'ajax'); goto SOgvx; xlKQi: $pay_tid_suffix = '0' . $pay_count; goto EXpUX; SAuCh: jFwRZ: goto uYXbV; usyKs: $pin_count = count($pin_count) + 1; goto vFap1; baCr3: goto QfBBd; goto x9foi; ecVac: $pay_count = pdo_fetchall('SELECT * FROM ' . tablename('core_paylog') . ' WHERE tid LIKE \'' . $sn_prefix . '%\''); goto iTFxc; eWMOH: b8fnh: goto lVehX; ec3qt: $new_member['status'] = '0'; goto j2J7v; vv9ju: if ($pay_count < 100) { goto jFwRZ; } goto PTwu2; wXHtY: pdo_insert('navlange_pinche_member', $new_member); goto DvFh1; YBBvX: $new_member['passenger_amount'] = $new_travel['amount']; goto zLIr5; x9foi: Ic1Ni: goto EyQUP; xK1oh: $new_travel['terminal_lng'] = $_GPC['terminal_lng']; goto L4Nd6; XeEOA: if (!($pay_count < 10000)) { goto zJums; } goto xlKQi; oxh_e: if (!($pin_count < 10000)) { goto xk3YP; } goto LZVZt; EXpUX: zJums: goto osvOS; UaEbV: $new_member['uid'] = $new_travel['uid']; goto YBBvX; Sp35d: $new_member['pin_id'] = $_GPC['id']; goto ABuR1; iTFxc: $pay_count = count($pay_count) + 1; goto Tqerr; mPCMW: ErUsz: goto BHXpM; oGjuA: if (!empty($is_exist)) { goto SPG0A; } goto ZbaDL; LBqjv: $new_travel['mobile'] = $_GPC['mobile']; goto C4pyt; jIDGS: QfBBd: goto KA2B0; txWV7: if ($_GPC['travel_id'] > 0) { goto ErUsz; } goto ib8Fn; KL3rJ: $new_travel['uid'] = mc_openid2uid($_W['openid']); goto V_GmJ; uTKHq: cpDlf: goto fb3BM; vFap1: if ($pin_count < 10) { goto Ic1Ni; } goto EOoVX; F4_Uj: SPG0A: goto pOQKc; fPWgl: $new_member['owner_id'] = $pin['owner_id']; goto Sp35d; JpOyd: $new_travel['status'] = '1'; goto Wf0jv; tP7Bc: fztCP: goto wrlpn; mFp9y: YkgAF: goto KfoqD; EOoVX: if ($pin_count < 100) { goto X2r8T; } goto VWURA; PRGfZ: $new_member['price'] = $pin['price']; goto wXHtY; VWURA: if ($pin_count < 1000) { goto b8fnh; } goto oxh_e; fb3BM: $client['uniacid'] = $_W['uniacid']; goto i0B4n; osvOS: goto Vn7Vc; goto mFp9y; mxajd: $this->join_pin_notify($member_id); goto qsC_N; dzqnh: $new_member['pay_tid'] = $sn_prefix . $pay_tid_suffix; goto PRGfZ; ABuR1: $new_member['travel_id'] = $travel_id; goto ypSb_; QYOjL: $is_exist = pdo_get('navlange_pinche_client', $client); goto oGjuA; tU3ge: y1jCe: goto dzqnh; ckW17: goto y7VoH; goto eWMOH; Lgb9_: $new_travel['terminal_station'] = $pin['terminal_station']; goto LE__w; oHl7X: $new_member['type'] = '1'; goto OShph; wrlpn: $new_member['uid'] = $travel['uid']; goto ozO4z; kXESm: $new_travel['departure_district'] = $pin['departure_district']; goto Lgb9_; iBP96: y7VoH: goto ZCrw6; KBX_7: $new_travel['terminal_district'] = $pin['terminal_district']; goto D2ibE; L4Nd6: $new_travel['terminal_lat'] = $_GPC['terminal_lat']; goto KL3rJ; Baa8q: $new_travel['uniacid'] = $_W['uniacid']; goto dgFKx; LZVZt: $pin_sn_suffix = '0' . $pin_count; goto Fcupf; bLtaX: $new_travel['openid'] = $_W['openid']; goto Baa8q; D2ibE: $new_travel['departure_time'] = $pin['departure_time']; goto uqTfT; dgFKx: $new_travel['release_time'] = TIMESTAMP; goto JpOyd; QZ0jT: $status = $this->join_pin_check($_GPC['id'], $_GPC['amount']); goto wALOc; wfKY8: $pin_count = pdo_fetchall('SELECT * FROM ' . tablename('navlange_pinche_member') . ' WHERE sn LIKE \'' . $sn_prefix . '%\''); goto usyKs; V_GmJ: $new_travel['expected_price'] = $_GPC['expected_price']; goto bLtaX; nxjWe: igdnY: goto mMDst; CRW6G: pdo_update('navlange_pinche_travel', array("status" => "1"), array("id" => $_GPC['travel_id'])); goto mzsth; MP1Vt: goto FW6Uz; goto mPCMW; UUl0e: BdN4r: goto olZLv; LE__w: $new_travel['terminal_city'] = $pin['terminal_city']; goto KBX_7; JdLkl: jZPN7: goto baCr3; DvFh1: $member_id = pdo_insertid(); goto THCgW; W1Dyn: pdo_insert('navlange_pinche_travel', $new_travel); goto cfOiq; BHXpM: $travel_id = $_GPC['travel_id']; goto CRW6G; OShph: $sn_prefix = date('YmdHis', $new_member['pin_time']); goto wfKY8; C4pyt: $new_travel['amount'] = $_GPC['amount']; goto OIwM5; WvgnL: $new_travel['lat'] = $_GPC['lat']; goto xK1oh; i0B4n: $client['uid'] = $_W['member']['uid']; goto QYOjL; Rnx9J: FW6Uz: goto z8Iy3; ypSb_: $new_member['pin_time'] = TIMESTAMP; goto ec3qt; OIwM5: $new_travel['boarding_place'] = $pin['boarding_place']; goto Mxf20; Wf0jv: $new_travel['type'] = '1'; goto W1Dyn; THCgW: $this->travel_join_pin_success($travel_id, $_GPC['id']); goto mxajd; SqkEc: goto BdN4r; goto SAuCh; mMDst: $new_member['openid'] = $_W['openid']; goto fPWgl; ozO4z: $new_member['passenger_amount'] = $travel['amount']; goto nxjWe; uqTfT: $new_travel['name'] = $_GPC['name']; goto LBqjv; wALOc: if (!($status != '0')) { goto cpDlf; } goto SPeFx; SOgvx: } public function cancel_member_by_passenger($member_id, $reason) { goto gksR_; XEXDA: tnVt3: goto TElVb; bcyxc: $member_info['status'] = '2'; goto DD_eu; cePLX: bjoo4: goto XEXDA; mnnJI: $this->passenger_cancel_notify($member_id); goto zuw1I; deraJ: pdo_update('navlange_pinche_client', $client_info, array("uid" => $member['uid'])); goto viiA6; x68sn: pdo_update('navlange_pinche_member', $member_info, array("id" => $member_id)); goto HByTt; NAycb: $client_info['credit_score'] = $client['credit_score'] + $conf['passenger_cancel_pin_credit_score']; goto deraJ; dVW10: foreach ($reason as $key => $value) { goto qbImB; cae4u: evdav: goto BmFMy; qbImB: $template = pdo_fetch('SELECT content FROM ' . tablename('navlange_pinche_note_template') . ' WHERE id=' . $value); goto zLGR1; zLGR1: if (!($reason != '')) { goto lGZ3w; } goto HWOPG; HWOPG: $reason_str .= ';'; goto a68ND; a68ND: lGZ3w: goto vsJ6Y; vsJ6Y: $reason_str .= $template['content']; goto cae4u; BmFMy: } goto cePLX; DD_eu: $reason_str = ''; goto Dlz5k; gksR_: global $_W; goto eX3DY; Dlz5k: if (empty($reason)) { goto tnVt3; } goto dVW10; HByTt: $this->cancel_member_success($member_id); goto mnnJI; eX3DY: $conf = pdo_fetch('SELECT passenger_cancel_pin_credit_score FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto Kd31K; Kd31K: $member = pdo_fetch('SELECT uid,owner_comming_to_departure_station FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto IERPa; IERPa: if (!($member['owner_comming_to_departure_station'] == '1')) { goto KPdZT; } goto vhoNj; vhoNj: $client = pdo_fetch('SELECT credit_score FROM ' . tablename('navlange_pinche_client') . ' WHERE uid=' . $member['uid']); goto NAycb; viiA6: KPdZT: goto bcyxc; TElVb: $member_info['cancel_reason'] = $reason_str; goto x68sn; zuw1I: } public function doMobileCancel_member_by_passenger() { goto uw8Jn; uw8Jn: global $_W, $_GPC; goto FwOte; byZ14: message(error(0, ''), '', 'ajax'); goto oEDBr; QOZUD: $member = pdo_fetch('SELECT travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['id']); goto X7QLL; FwOte: $this->cancel_member_by_passenger($_GPC['id'], $_GPC['reason']); goto QOZUD; X7QLL: pdo_update('navlange_pinche_travel', array("status" => "2"), array("id" => $member['travel_id'])); goto byZ14; oEDBr: } public function doMobileCancel_travel() { goto Kdog5; u4Xu0: foreach ($member_list as $key => $value) { $this->cancel_member_by_passenger($value['id'], $_GPC['reason']); BSQja: } goto j3WFx; j3WFx: NIWXH: goto feFmD; kcqJL: $member_list = pdo_fetchall('SELECT id FROM ' . tablename('navlange_pinche_member') . ' WHERE travel_id=' . $_GPC['id']); goto u4Xu0; Kdog5: global $_W, $_GPC; goto kcqJL; feFmD: pdo_update('navlange_pinche_travel', array("status" => "2"), array("id" => $_GPC['id'])); goto swIlF; swIlF: message(error(0, ''), '', 'ajax'); goto k6Qn9; k6Qn9: } public function doMobilePassenger_confirm_arrive_pin() { goto vgFaD; qUsDu: message(error(0, ''), '', 'ajax'); goto tBYqv; nWmku: $this->confirm_arrival($_GPC['id']); goto qUsDu; vgFaD: global $_GPC; goto nWmku; tBYqv: } public function doMobilePassenger_comment_pin() { goto debey; HZQ8t: $conf = pdo_fetch('SELECT comment_level_0_point,comment_level_1_point,comment_level_2_point FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto fXq6T; Wdnhs: iRdlF: goto yqms1; kQgQa: $comment['type'] = '0'; goto HZQ8t; rkTAP: $score = $owner['credit_score'] + $conf['comment_level_2_point']; goto VInyT; dR2y8: message(error(0, ''), '', 'ajax'); goto LCElB; ymcje: pdo_insert('navlange_pinche_comment', $comment); goto dR2y8; jDExR: foreach ($_GPC['template'] as $key => $value) { goto RPHt7; PW4_Q: array_push($content, $template['content']); goto nJJxd; RPHt7: $template = pdo_get('navlange_pinche_comment_template', array("id" => $value)); goto PW4_Q; nJJxd: UzSqa: goto jwFiK; jwFiK: } goto pxBqH; debey: global $_W, $_GPC; goto D5MmP; puGu5: $comment['comment_level'] = $_GPC['comment_level']; goto kQgQa; Lu70y: $content = array(); goto FQt2n; D6D8a: $comment['content'] = json_encode($content); goto mDAjE; UVHeh: if (!($score > 100)) { goto ThNRx; } goto dw7Xj; B4jhc: $comment['uid'] = $_W['member']['uid']; goto Lu70y; fXq6T: $pin = pdo_fetch('SELECT owner_id FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $member['pin_id']); goto Sxn16; giieL: if (!($_GPC['other'] != '')) { goto iRdlF; } goto yI3YO; pxBqH: xx_QO: goto D6D8a; Sxn16: $owner = pdo_fetch('SELECT * FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $pin['owner_id']); goto wDm2Y; XDlQX: if (!($_GPC['comment_level'] == '2')) { goto twE8n; } goto rkTAP; EazCu: YzaSo: goto F0efd; dJtJC: $comment['pin_id'] = $member['pin_id']; goto TfMZ0; hcfqR: pdo_update('navlange_pinche_owner', array("credit_score" => $score), array("id" => $owner['id'])); goto ymcje; qmW3y: $comment['uniacid'] = $_W['uniacid']; goto TtIIK; MMiNF: $comment['travel_id'] = $member['travel_id']; goto qmW3y; mlhyl: $comment = pdo_fetch('SELECT pin.owner_id as owner_id,pin.uid as owner_uid,pin.openid as owner_openid FROM ' . tablename('navlange_pinche_pin') . ' AS pin WHERE pin.id=' . $member['pin_id']); goto dJtJC; yqms1: $comment['time'] = TIMESTAMP; goto puGu5; F0efd: $score = $owner['credit_score'] + $conf['comment_level_1_point']; goto EC7ju; wDm2Y: if ($_GPC['comment_level'] == '0') { goto Mni_H; } goto eZWkE; FQt2n: if (empty($_GPC['template'])) { goto e00qz; } goto jDExR; VInyT: twE8n: goto an2hT; EC7ju: cRABS: goto gTq32; BY0ir: Mni_H: goto YINb6; eZWkE: if ($_GPC['comment_level'] == '1') { goto YzaSo; } goto XDlQX; YINb6: $score = $owner['credit_score'] + $conf['comment_level_0_point']; goto IiTrw; TfMZ0: $comment['member_id'] = $_GPC['member_id']; goto MMiNF; gTq32: goto uK8UU; goto BY0ir; mDAjE: e00qz: goto giieL; lKrVW: ThNRx: goto hcfqR; dw7Xj: $score = 100; goto lKrVW; D5MmP: $member = pdo_fetch('SELECT pin_id,travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['member_id']); goto mlhyl; IiTrw: uK8UU: goto UVHeh; yI3YO: $comment['other'] = $_GPC['other']; goto Wdnhs; an2hT: goto cRABS; goto EazCu; TtIIK: $comment['openid'] = $_W['openid']; goto B4jhc; LCElB: } public function pin_releaseable() { goto fyUkD; JFg5F: $travel = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_travel') . ' WHERE uid=' . $_W['member']['uid'] . ' AND (status=\'0\' OR status=\'1\' OR status=\'3\' OR status=\'4\')'); goto lQ2gk; Oo0ww: if ($login_status) { goto aG7LF; } goto gjYXB; Qi6Gp: $pin = pdo_fetch('SELECT id FROM ' . tablename('navlange_pinche_pin') . ' WHERE uid=' . $_W['member']['uid'] . ' AND type=\'1\' AND (status=\'0\' || status=\'1\')' . ' AND departure_time>' . TIMESTAMP); goto QeXLi; HxkWa: return '0'; goto Bclfo; fyUkD: global $_W; goto bbz6L; uF7xd: $conf = pdo_fetch('SELECT pin_release_multi_on FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto dYvGR; lQ2gk: if (empty($travel)) { goto p7k7n; } goto b7nuV; C9Xpz: O6oDz: goto Qi6Gp; bbz6L: $login_status = $this->check_mobile_login(); goto Oo0ww; tigiR: goto sAL_K; goto C9Xpz; pI6MQ: aG7LF: goto uF7xd; sbDn0: Dt2VZ: goto JFg5F; QeXLi: if (empty($pin)) { goto Dt2VZ; } goto Iw_cZ; Bclfo: sAL_K: goto fcHKy; Om1Wu: return '0'; goto tigiR; dYvGR: if ($conf['pin_release_multi_on'] == '0') { goto O6oDz; } goto Om1Wu; Iw_cZ: return '1'; goto sbDn0; QeMIM: p7k7n: goto HxkWa; b7nuV: return '2'; goto QeMIM; gjYXB: return '10'; goto pI6MQ; fcHKy: } public function accept_travel($pin_id, $travel_id) { goto vFzOc; NhfXZ: $pay_tid_suffix = '000' . $pay_count; goto ASEga; YJX_d: $pin_sn_suffix = '0000' . $pin_count; goto bmdjQ; auj8V: pBeyX: goto YJX_d; oTmuG: $this->travel_join_pin_success($travel_id, $pin_id); goto rxpKM; ta8ZY: foreach ($member as $key => $value) { goto hlYM2; IesFt: O3j82: goto iGSZM; hlYM2: $confirmed_travel = pdo_get('navlange_pinche_travel', array("id" => $value['travel_id'])); goto kp1OY; kp1OY: $pined_count += $confirmed_travel['amount']; goto IesFt; iGSZM: } goto coenz; vFzOc: global $_W; goto dFOiw; cCHWq: dHHwJ: goto ErflI; rxpKM: $this->accept_passenger_notify($new_member_id); goto LhhtF; Cd2ka: pdo_insert('navlange_pinche_member', $new_member); goto rXvxI; zZg84: if (!($pay_count < 10000)) { goto A0ftC; } goto rsHKU; Qbnfz: $new_member['status'] = '1'; goto b11X3; ui0vZ: $pay_tid_suffix = '0000' . $pay_count; goto GCp7d; MQDEi: goto MZ6T_; goto As2gm; yXXhZ: pdo_update('navlange_pinche_travel', array("status" => "1", "owner_confirmed" => "1"), array("id" => $travel_id)); goto oTmuG; wFccB: goto OGGFb; goto QO1IA; AOS9E: $new_member['passenger_amount'] = $travel['amount']; goto Cd2ka; BwPMG: if ($pin_count < 100) { goto vJ0E3; } goto AfNTv; zWVNO: $pin = pdo_fetch('SELECT owner_id,passenger_count,price FROM ' . tablename('navlange_pinche_pin') . ' WHERE id=' . $pin_id); goto ow8bL; QO1IA: uM1e3: goto Oae6J; ptq4w: if ($pined_count + $travel['amount'] > $pin['passenger_count']) { goto cIqI1; } goto nlLYz; bmdjQ: RiluU: goto Sqi71; mV1fM: $new_member['price'] = $travel['expected_price']; goto Erigv; wGKUk: $new_member['owner_id'] = $pin['owner_id']; goto FuuHb; ga0F2: zMbst: goto ui0vZ; RlmIk: $pin_sn_suffix = '0' . $pin_count; goto nTgsL; Sqi71: $new_member['sn'] = $sn_prefix . $pin_sn_suffix; goto WOdZp; rXvxI: $new_member_id = pdo_insertid(); goto yXXhZ; N6vBA: $pined_count = 0; goto ta8ZY; nTgsL: ko4dX: goto IG4UA; LhhtF: goto dHHwJ; goto k2TYq; k2TYq: cIqI1: goto EG5Yq; lwPij: goto DNNpT; goto ga0F2; OzZkx: if ($pay_count < 100) { goto w1ngl; } goto Rr4sn; coenz: T0gpt: goto ptq4w; IG4UA: goto lA0l0; goto ZPxja; q8lYw: goto RiluU; goto auj8V; Oae6J: $pay_tid_suffix = '00' . $pay_count; goto suFKH; b11X3: $new_member['uniacid'] = $_W['uniacid']; goto R6iyB; pgXDj: $new_member['pay_tid'] = $sn_prefix . $pay_tid_suffix; goto mV1fM; S_Q6q: PM6hP: goto q8lYw; WOdZp: $pay_count = pdo_fetchall('SELECT * FROM ' . tablename('core_paylog') . ' WHERE tid LIKE \'' . $sn_prefix . '%\''); goto csjrv; AfNTv: if ($pin_count < 1000) { goto stoXM; } goto fN9vg; qZL1H: $new_member['pin_time'] = TIMESTAMP; goto Qbnfz; ZPxja: stoXM: goto nn2EL; aoNUb: lA0l0: goto Ir7Tn; GCp7d: DNNpT: goto pgXDj; nlLYz: $new_member['openid'] = $travel['openid']; goto ok9Y0; As2gm: w1ngl: goto NhfXZ; R6iyB: $sn_prefix = date('YmdHis', $new_member['pin_time']); goto AU14k; FuuHb: $new_member['pin_id'] = $pin_id; goto qZL1H; PxCzt: $pin_count = count($pin_count) + 1; goto BQhpW; ASEga: MZ6T_: goto lwPij; EG5Yq: message(error(1, 'FULL'), '', 'ajax'); goto cCHWq; KfOsf: if ($pay_count < 10) { goto zMbst; } goto OzZkx; dFOiw: $travel = pdo_fetch('SELECT uid,openid,amount,expected_price,type FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $travel_id); goto zWVNO; YYcki: A0ftC: goto wFccB; GJFXG: $new_member['travel_id'] = $travel_id; goto wGKUk; BQhpW: if ($pin_count < 10) { goto pBeyX; } goto BwPMG; ok9Y0: $new_member['uid'] = $travel['uid']; goto GJFXG; AU14k: $pin_count = pdo_fetchall('SELECT * FROM ' . tablename('navlange_pinche_member') . ' WHERE sn LIKE \'' . $sn_prefix . '%\''); goto PxCzt; ma2P_: $pin_sn_suffix = '000' . $pin_count; goto S_Q6q; Erigv: $new_member['type'] = $travel['type']; goto AOS9E; Rr4sn: if ($pay_count < 1000) { goto uM1e3; } goto zZg84; csjrv: $pay_count = count($pay_count) + 1; goto KfOsf; fN9vg: if (!($pin_count < 10000)) { goto ko4dX; } goto RlmIk; Ir7Tn: goto PM6hP; goto BFq2s; ow8bL: $member = pdo_getall('navlange_pinche_member', array("uniacid" => $_W['uniacid'], "pin_id" => $pin_id, "status" => "1")); goto N6vBA; suFKH: OGGFb: goto MQDEi; BFq2s: vJ0E3: goto ma2P_; nn2EL: $pin_sn_suffix = '00' . $pin_count; goto aoNUb; rsHKU: $pay_tid_suffix = '0' . $pay_count; goto YYcki; ErflI: } public function doMobileGenerate_pin_and_accept_travel() { goto kN97j; xraTC: q2onG: goto Li6Ft; D6Ntt: $item['time'] = TIMESTAMP; goto eHfld; HYWVT: $pin['passenger_count'] = $_GPC['passenger_count']; goto LGeXJ; xnK1t: $item['uid'] = $_W['member']['uid']; goto eoZh1; emGKD: $pin['status'] = '0'; goto PWupC; PWupC: $pin['type'] = '1'; goto VX_Td; Dg0Tu: $pin['car_color'] = $owner['car_color']; goto R56Bn; lGi2M: $pin['owner_id'] = $owner['id']; goto FrrOX; eOEbb: $pin['boarding_place'] = $travel['boarding_place']; goto hRjPG; BL1mQ: gXtDO: goto vimpq; lgiK9: $pin['terminal_station'] = $_GPC['terminal_station']; goto siq0p; owrAh: $mc_member = pdo_fetch('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto EVaq6; OaDim: $pin['release_time'] = TIMESTAMP; goto emGKD; YHIxy: $pin['terminal_city'] = $_GPC['terminal_city']; goto lgiK9; Li6Ft: $pin['openid'] = $_W['openid']; goto kSUSQ; R56Bn: $pin['departure_city'] = $_GPC['departure_city']; goto g07WJ; q_btY: $item['integral'] = $marketing_conf['owner_release_pin_integral']; goto D6Ntt; VX_Td: $pin['stations'] = $_GPC['stations']; goto CL7W0; uhs09: $exists_record = pdo_fetchcolumn('SELECT COUNT(id) FROM ' . tablename('navlange_pinche_integral_record') . ' WHERE type=\'0\' AND uid=' . $_W['member']['uid'] . ' AND time>=' . strtotime(date('Y-m-d', TIMESTAMP)) . ' AND time<' . (strtotime(date('Y-m-d', TIMESTAMP)) + 24 * 60 * 60)); goto BzLCw; ueO99: message(error(10, ''), '', 'ajax'); goto uls8q; CL7W0: pdo_insert('navlange_pinche_pin', $pin); goto rAkze; uls8q: rbSQH: goto P1_Ii; P1_Ii: $travel = pdo_fetch('SELECT * FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $_GPC['travel_id']); goto Dct3U; hRjPG: $pin['lng'] = $travel['lng']; goto EJkmd; eHfld: $item['pin_id'] = $id; goto ruad5; fr3cW: $item = array(); goto xTLyD; FrrOX: $pin['car_number'] = $owner['car_number_1'] . $owner['car_number_2'] . $owner['car_number_3']; goto kuOII; kN97j: global $_W, $_GPC; goto iH4gR; LGeXJ: $pin['left_amount'] = $_GPC['passenger_count']; goto Jk3sD; vimpq: message(error(0, $id), '', 'ajax'); goto jb5bK; rAkze: $id = pdo_insertid('navlange_pinche_pin'); goto d0VlQ; g07WJ: $pin['departure_station'] = $_GPC['departure_station']; goto YHIxy; ruad5: pdo_insert('navlange_pinche_integral_record', $item); goto BL1mQ; Dct3U: if (!($travel['uid'] == $_W['member']['uid'])) { goto q2onG; } goto LiDMJ; BzLCw: if (!($exists_record < $marketing_conf['owner_release_pin_integral_per_day'] && $marketing_conf['owner_release_pin_integral'] > 0)) { goto gXtDO; } goto owrAh; eoZh1: $item['type'] = '0'; goto q_btY; UcliI: $marketing_conf = pdo_fetch('SELECT owner_release_pin_integral,owner_release_pin_integral_per_day FROM ' . tablename('navlange_pinche_marketing_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto uhs09; xTLyD: $item['uniacid'] = $_W['uniacid']; goto xnK1t; zjC4Q: $pin['price'] = $_GPC['price']; goto HYWVT; kuOII: $pin['car_series'] = $owner['car_series']; goto Dg0Tu; LiDMJ: message(error(1, ''), '', 'ajax'); goto xraTC; OCaH5: $pin['uniacid'] = $_W['uniacid']; goto OaDim; ImUwz: $owner = pdo_get('navlange_pinche_owner', array("uid" => $_W['member']['uid'])); goto lGi2M; kSUSQ: $pin['uid'] = $_W['member']['uid']; goto ImUwz; Jk3sD: $pin['pined_amount'] = 0; goto A8T2R; iH4gR: $login_status = $this->check_mobile_login(); goto gpRBf; EVaq6: pdo_update('mc_members', array("credit1" => $mc_member['credit1'] + $marketing_conf['owner_release_pin_integral']), array("uid" => $_W['member']['uid'])); goto fr3cW; EJkmd: $pin['lat'] = $travel['lat']; goto zjC4Q; siq0p: $pin['departure_time'] = $travel['departure_time']; goto eOEbb; d0VlQ: $this->accept_travel($id, $_GPC['travel_id']); goto UcliI; A8T2R: $pin['note'] = $_GPC['note']; goto OCaH5; gpRBf: if ($login_status) { goto rbSQH; } goto ueO99; jb5bK: } public function doMobileAccept_travel_pin() { goto TeYil; kA8SV: message(error(0, ''), '', 'ajax'); goto LeRVO; TeYil: global $_W, $_GPC; goto pnD39; pnD39: $this->accept_travel($_GPC['pin_id'], $_GPC['travel_id']); goto kA8SV; LeRVO: } public function doMobileRelease_pin_submit() { goto K_9Iz; yB1GE: $pin['departure_district'] = $_GPC['departure_district']; goto Lgj1r; Zhizy: $pin['car_series'] = $owner['car_series']; goto aZuAT; WoXZ3: $marketing_conf = pdo_fetch('SELECT owner_release_pin_integral,owner_release_pin_integral_per_day FROM ' . tablename('navlange_pinche_marketing_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto zkSQo; K_9Iz: global $_W, $_GPC; goto ri2oD; rZFju: $pin['price'] = $_GPC['price']; goto XVpp6; U1diY: $item['type'] = '0'; goto oxb1M; tzOR6: $pin['car_number'] = $owner['car_number_1'] . $owner['car_number_2'] . $owner['car_number_3']; goto Zhizy; AIzQp: $pin['departure_time'] = strtotime($_GPC['departure_time']); goto ozDMq; rDHuJ: $pin['pined_amount'] = 0; goto AIzQp; zkSQo: $exists_record = pdo_fetchcolumn('SELECT COUNT(id) FROM ' . tablename('navlange_pinche_integral_record') . ' WHERE type=\'0\' AND uid=' . $_W['member']['uid'] . ' AND time>=' . strtotime(date('Y-m-d', TIMESTAMP)) . ' AND time<' . (strtotime(date('Y-m-d', TIMESTAMP)) + 24 * 60 * 60)); goto jPLax; XYn3F: $pin['uniacid'] = $_W['uniacid']; goto Ba5Vg; JeQ9j: message(error($status, ''), '', 'ajax'); goto LZZIv; YqqjH: $pin['owner_id'] = $owner['id']; goto tzOR6; jA0OM: $item['time'] = TIMESTAMP; goto kiFQR; yTT9Q: $pin['terminal_district'] = $_GPC['terminal_district']; goto w0OMN; h3aDs: if (!($status != '0')) { goto i7Dt6; } goto JeQ9j; dNW1c: $item = array(); goto dbkrF; WumTp: $pin['lat'] = $_GPC['lat']; goto rZFju; S07R5: $pin['departure_city'] = $_GPC['departure_city']; goto yB1GE; Rj8eS: $id = pdo_insertid('navlange_pinche_pin'); goto WoXZ3; FnKSJ: $owner = pdo_get('navlange_pinche_owner', array("uid" => $_W['member']['uid'])); goto YqqjH; BVNwr: $mc_member = pdo_fetch('SELECT credit1 FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto TZ39I; a8Tqq: message(error(0, ''), '', 'ajax'); goto TwtPs; aZuAT: $pin['car_color'] = $owner['car_color']; goto S07R5; V0nGV: $pin['terminal_city'] = $_GPC['terminal_city']; goto yTT9Q; kiFQR: $item['pin_id'] = $id; goto kTRpn; jPLax: if (!($exists_record < $marketing_conf['owner_release_pin_integral_per_day'] && $marketing_conf['owner_release_pin_integral'] > 0)) { goto jSy6Z; } goto BVNwr; q91T8: $pin['openid'] = $_W['openid']; goto Vfc1o; tIuDK: jSy6Z: goto a8Tqq; lbfUs: $pin['stations'] = $_GPC['stations']; goto dPa1z; LZZIv: i7Dt6: goto q91T8; ozDMq: $pin['lng'] = $_GPC['lng']; goto WumTp; TZ39I: pdo_update('mc_members', array("credit1" => $mc_member['credit1'] + $marketing_conf['owner_release_pin_integral']), array("uid" => $_W['member']['uid'])); goto dNW1c; Ba5Vg: $pin['release_time'] = TIMESTAMP; goto uMNGL; XVpp6: $pin['note'] = $_GPC['note']; goto XYn3F; Vfc1o: $pin['uid'] = $_W['member']['uid']; goto FnKSJ; ri2oD: $status = $this->pin_releaseable(); goto h3aDs; w0OMN: $pin['terminal_station'] = $_GPC['terminal_station']; goto R2qNp; gH228: $pin['left_amount'] = $_GPC['passenger_count']; goto rDHuJ; dbkrF: $item['uniacid'] = $_W['uniacid']; goto wXJR6; Lgj1r: $pin['departure_station'] = $_GPC['departure_station']; goto V0nGV; oxb1M: $item['integral'] = $marketing_conf['owner_release_pin_integral']; goto jA0OM; kTRpn: pdo_insert('navlange_pinche_integral_record', $item); goto tIuDK; uMNGL: $pin['status'] = '0'; goto lbfUs; R2qNp: $pin['passenger_count'] = $_GPC['passenger_count']; goto gH228; dPa1z: pdo_insert('navlange_pinche_pin', $pin); goto Rj8eS; wXJR6: $item['uid'] = $_W['member']['uid']; goto U1diY; TwtPs: } public function doMobileEdit_pin_submit() { goto Z2tXo; jSWWk: $pin['price'] = $_GPC['price']; goto WVTy5; cGSWl: $pin['lng'] = $_GPC['lng']; goto rpkt6; uZWkU: $pin['terminal_city'] = $_GPC['terminal_city']; goto ZyzvH; rpkt6: $pin['lat'] = $_GPC['lat']; goto jSWWk; SDuZA: message(error(0, ''), '', 'ajax'); goto hyUpc; wz_39: $pin['departure_station'] = $_GPC['departure_station']; goto uZWkU; JYg3k: $pin['stations'] = $_GPC['stations']; goto jE45t; jE45t: pdo_update('navlange_pinche_pin', $pin, array("id" => $_GPC['id'])); goto SDuZA; Z2tXo: global $_GPC; goto ki_OU; ki_OU: $pin['departure_city'] = $_GPC['departure_city']; goto wz_39; ZyzvH: $pin['terminal_station'] = $_GPC['terminal_station']; goto wRLRX; WVTy5: $pin['note'] = $_GPC['note']; goto JYg3k; wRLRX: $pin['departure_time'] = strtotime($_GPC['departure_time']); goto cGSWl; hyUpc: } public function doMobileOwner_arrive_terminal_station_pin() { goto sHu2x; Sl1w3: $member = pdo_fetch('SELECT status,travel_id,pin_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['member_id']); goto krw00; XE1h7: $pin_member_list = pdo_fetchall('SELECT status FROM ' . tablename('navlange_pinche_member') . ' WHERE pin_id=' . $member['pin_id']); goto XThzY; bD3iB: message(error(0, ''), '', 'ajax'); goto t14Q7; cqEhM: H7FJG: goto RWdj9; gZEjn: V7tau: goto bD3iB; RWdj9: if (!($finished == true)) { goto V7tau; } goto y8wVN; y8wVN: pdo_update('navlange_pinche_pin', array("status" => "3"), array("id" => $member['pin_id'])); goto gZEjn; krw00: pdo_update('navlange_pinche_travel', array("status" => "6"), array("id" => $member['travel_id'])); goto f5zqD; f5zqD: pdo_update('navlange_pinche_member', array("status" => "6"), array("id" => $_GPC['member_id'])); goto XE1h7; PVxY1: foreach ($pin_member_list as $key => $value) { goto dNCbJ; RVBJp: QdXyi: goto f0d0Q; f0d0Q: Ql_m2: goto qOytm; dNCbJ: if (!($value['status'] == '0' || $value['status'] == '1' || $value['status'] == '3' || $value['status'] == '4')) { goto QdXyi; } goto WgzNI; WgzNI: $finished = false; goto IDI0i; IDI0i: goto H7FJG; goto RVBJp; qOytm: } goto cqEhM; sHu2x: global $_W, $_GPC; goto Sl1w3; XThzY: $finished = true; goto PVxY1; t14Q7: } public function doMobileCancel_member_by_owner() { goto KC7ot; KC7ot: global $_GPC; goto EvxgS; C4mKj: pdo_update('navlange_pinche_member', $member_info, array("id" => $_GPC['member_id'])); goto NdRQ9; LY3VE: $member_info['owner_cancel_reason'] = $_GPC['cancel_reason']; goto ExKRd; EvxgS: $member = pdo_fetch('SELECT travel_id,pin_id,passenger_amount FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $_GPC['member_id']); goto T3n87; ExKRd: $member_info['owner_cancel_lng'] = $_GPC['lng']; goto OJIfZ; T3n87: $member_info['status'] = '2'; goto LY3VE; NdRQ9: pdo_update('navlange_pinche_travel', array("status" => "2"), array("id" => $member['travel_id'])); goto qvN_r; qvN_r: $this->cancel_member_success($_GPC['member_id']); goto fG7sb; OJIfZ: $member_info['owner_cancel_lat'] = $_GPC['lat']; goto C4mKj; fG7sb: $this->owner_cancel_notify($_GPC['member_id']); goto wsxDn; wsxDn: message(error(0, ''), '', 'ajax'); goto sCQD8; sCQD8: } public function doMobileCancel_pin() { goto pqW6X; UBPUu: yn86m: goto fzEUw; i95gd: message(error(0, ''), '', 'ajax'); goto pwnNX; nLR0w: foreach ($member as $key => $value) { goto pWZ4x; QUMNW: x53IM: goto yipg4; pWZ4x: if (!($value['status'] == '0' || $value['status'] == '1' || $value['status'] == '3' || $value['status'] == '4')) { goto tfENE; } goto n155q; n155q: pdo_update('navlange_pinche_travel', array("status" => "0"), array("id" => $value['travel_id'])); goto E7brQ; E7brQ: tfENE: goto Is2FI; Is2FI: pdo_update('navlange_pinche_member', array("status" => "2"), array("id" => $value['id'])); goto QUMNW; yipg4: } goto UBPUu; fzEUw: pdo_update('navlange_pinche_pin', array("status" => "2"), array("id" => $_GPC['id'])); goto i95gd; Fhj9P: $member = pdo_fetchall('SELECT id,travel_id,status FROM ' . tablename('navlange_pinche_member') . ' WHERE pin_id=' . $_GPC['id']); goto nLR0w; pqW6X: global $_GPC; goto Fhj9P; pwnNX: } public function doMobileOwner_withdraw_submit() { goto nDYGT; up1P6: pdo_insert('navlange_pinche_credit3_record', $pay); goto drV78; oFBbG: $pay['mode'] = '2'; goto x8isa; QaBdC: InJNu: goto OqJr1; zQEDz: $pay['money'] = $_GPC['money']; goto gJOQ0; zrdD1: $pay['generate_time'] = TIMESTAMP; goto iqA4Y; AqCLE: $pay['pay_tid'] = $pay['tid']; goto l0gTr; kCpym: $owner['withdrawed_income'] = $owner['withdrawed_income'] + $_GPC['money']; goto eytyN; jyyWo: LPyi_: goto R7xVl; g8SKY: ZWVOs: goto oFBbG; DxeHP: goto kwocX; goto PzAva; KvWon: pdo_update('mc_members', $mc_member, array("uid" => $_W['member']['uid'])); goto kCpym; jBL2X: if (!($pay_count < 10000)) { goto dpWiS; } goto adFif; eytyN: pdo_update('navlange_pinche_owner', $owner, array("uid" => $_W['member']['uid'])); goto zrdD1; l0gTr: $index = 0; goto OT9gI; T1uv6: DA_PP: goto oklNe; oklNe: $pay['tid'] = $sn_prefix . $pay_sn_suffix; goto i8HCW; zcF3Z: pdo_insert('navlange_enterprise_pay', $pay); goto AqCLE; x8isa: $pay['desc'] = '司机提现'; goto up1P6; Viccx: if ($pay_count < 10) { goto WL3Q0; } goto jMHvs; qBMml: i5rZE: goto TvKy1; AU8ij: $mc_member = pdo_fetch('SELECT credit3 FROM ' . tablename('mc_members') . ' WHERE uid=' . $_W['member']['uid']); goto ffSLZ; jMHvs: if ($pay_count < 100) { goto AZ3Fh; } goto WqSgZ; OT9gI: foreach ($pay as $key => $value) { goto f0bSv; U0Tvb: array_splice($pay, $index, 1); goto U2oAr; ZrJoB: vt0DG: goto UQ2AS; WgE4L: $index += 1; goto ZrJoB; f0bSv: if (!($key == 'tid')) { goto QQraA; } goto U0Tvb; U2oAr: QQraA: goto WgE4L; UQ2AS: } goto g8SKY; PzAva: IxELM: goto iGB4i; ojgWs: goto LPyi_; goto qBMml; ooXXd: $pay_count = count($pay_count) + 1; goto Viccx; OoNW4: $pay_sn_suffix = '0000' . $pay_count; goto T1uv6; R3RrQ: AZ3Fh: goto DhB2d; HNttD: $pay_count = pdo_fetchall('SELECT * FROM ' . tablename('navlange_enterprise_pay') . ' WHERE tid LIKE \'' . $sn_prefix . '%\''); goto ooXXd; OqJr1: goto DA_PP; goto p3rIk; b1OF7: if (!$owner || $mc_member['credit3'] < $_GPC['money']) { goto IxELM; } goto QfAt7; COBJu: $pay['uid'] = $_W['member']['uid']; goto Kj5vK; Kj5vK: $pay['openid'] = $_W['openid']; goto zQEDz; lnmpX: dpWiS: goto ojgWs; i8HCW: $pay['uniacid'] = $_W['uniacid']; goto COBJu; TvKy1: $pay_sn_suffix = '00' . $pay_count; goto jyyWo; wQP4o: kwocX: goto xD6KG; DhB2d: $pay_sn_suffix = '000' . $pay_count; goto QaBdC; iGB4i: message(error(1, 'OVER_CREDIT'), '', 'ajax'); goto wQP4o; WqSgZ: if ($pay_count < 1000) { goto i5rZE; } goto jBL2X; R7xVl: goto InJNu; goto R3RrQ; nDYGT: global $_W, $_GPC; goto AU8ij; ffSLZ: $owner = pdo_fetch('SELECT withdrawed_income FROM ' . tablename('navlange_pinche_owner') . ' WHERE uid=' . $_W['member']['uid']); goto b1OF7; p3rIk: WL3Q0: goto OoNW4; adFif: $pay_sn_suffix = '0' . $pay_count; goto lnmpX; gJOQ0: $pay['status'] = '0'; goto zcF3Z; QfAt7: $mc_member['credit3'] = $mc_member['credit3'] - $_GPC['money']; goto KvWon; iqA4Y: $sn_prefix = date('YmdHis', $pay['generate_time']); goto HNttD; drV78: message(error(2, ''), '', 'ajax'); goto DxeHP; xD6KG: } function join_result_sms($tel, $name, $owner_tel) { goto bvlPG; jDw22: goto QFjAy; goto rXIDm; f5vma: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto hsCjA; kGEtm: goto J28xA; goto bISKu; Lif2O: if ($content) { goto CuFRB; } goto SWTYG; rXIDm: CuFRB: goto dpfw4; G0hyK: $error_code = $result['error_code']; goto dlh7S; bISKu: iNIR0: goto ntySf; buXGZ: J28xA: goto SKLey; uvhEn: $sendUrl = 'http://v.juhe.cn/sms/send'; goto f5vma; SKLey: QFjAy: goto ZsjpF; dlh7S: if ($error_code == 0) { goto iNIR0; } goto TYdDA; bvlPG: global $_W; goto uvhEn; SWTYG: return 2; goto jDw22; JAwt0: $content = $this->juhecurl($sendUrl, $smsConf, 1); goto Lif2O; dpfw4: $result = json_decode($content, true); goto G0hyK; TYdDA: return 1; goto kGEtm; ntySf: return 0; goto buXGZ; hsCjA: $smsConf = array("key" => $message['juhe_key'], "mobile" => $tel, "tpl_id" => $message['join_result_juhe_id'], "tpl_value" => '#name#=' . $name . '&#tel#=' . $owner_tel); goto JAwt0; ZsjpF: } function join_notice_sms($tel, $owner_name, $passenger_tel) { goto xWwoR; lSUIq: $result = json_decode($content, true); goto UL_TD; PBKyv: goto po0A2; goto PxmaH; UL_TD: $error_code = $result['error_code']; goto uvzed; uvzed: if ($error_code == 0) { goto Wz1m5; } goto MDNnI; Na3lh: sf0AH: goto W_FZh; u4h1p: $content = $this->juhecurl($sendUrl, $smsConf, 1); goto vrLc4; W_3aY: goto sf0AH; goto fEWt1; PxmaH: VQjSW: goto lSUIq; Xuaou: $sendUrl = 'http://v.juhe.cn/sms/send'; goto JYrML; VTjj_: $smsConf = array("key" => $message['juhe_key'], "mobile" => $tel, "tpl_id" => $message['join_notice_juhe_id'], "tpl_value" => '#name#=' . $owner_name . '&#tel#=' . $passenger_tel); goto u4h1p; JYrML: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto VTjj_; fEWt1: Wz1m5: goto L5ol0; L5ol0: return 0; goto Na3lh; vrLc4: if ($content) { goto VQjSW; } goto rX5El; rX5El: return 2; goto PBKyv; MDNnI: return 1; goto W_3aY; xWwoR: global $_W; goto Xuaou; W_FZh: po0A2: goto x9joI; x9joI: } function release_success_sms($tel, $owner_name) { goto AIBhN; SpK79: if ($content) { goto soK70; } goto No66h; LfVzD: soK70: goto fQufU; WaFSl: goto viprA; goto h8fPX; bm1wS: viprA: goto yyuI8; qe12W: $smsConf = array("key" => $message['juhe_key'], "mobile" => $tel, "tpl_id" => $message['release_success_juhe_id'], "tpl_value" => '#name#=' . $owner_name); goto fLWhA; fLWhA: $content = $this->juhecurl($sendUrl, $smsConf, 1); goto SpK79; AIBhN: global $_W; goto E21nL; l25yV: return 0; goto bm1wS; E21nL: $sendUrl = 'http://v.juhe.cn/sms/send'; goto cJAFx; ld8Kr: return 1; goto WaFSl; RqP5w: goto iYtxB; goto LfVzD; yyuI8: iYtxB: goto STIUw; giLCq: if ($error_code == 0) { goto vm4Mm; } goto ld8Kr; h8fPX: vm4Mm: goto l25yV; TNGJb: $error_code = $result['error_code']; goto giLCq; fQufU: $result = json_decode($content, true); goto TNGJb; cJAFx: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto qe12W; No66h: return 2; goto RqP5w; STIUw: } function juhecurl($url, $params = false, $ispost = 0) { goto g5y8s; A5wag: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto PIo2R; aNlM0: goto OTHyR; goto YDlH1; WwE6E: RPEKv: goto aNlM0; Fq9el: curl_setopt($ch, CURLOPT_POSTFIELDS, $params); goto qHUEm; Lemmo: return $response; goto Zt45t; NKEEg: OTHyR: goto v_Y1z; nxKwH: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30); goto XkQ2I; tUbyJ: $ch = curl_init(); goto M4fwx; k1CZZ: if ($ispost) { goto ZXcl9; } goto L0loS; pQOQ_: curl_setopt($ch, CURLOPT_POST, true); goto Fq9el; YDlH1: ZXcl9: goto pQOQ_; VH9hK: if (!($response === FALSE)) { goto SuVNO; } goto p_X40; PIo2R: $httpInfo = array_merge($httpInfo, curl_getinfo($ch)); goto bcV_E; M4fwx: curl_setopt($ch, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1); goto Vmvit; qHUEm: curl_setopt($ch, CURLOPT_URL, $url); goto NKEEg; v_Y1z: $response = curl_exec($ch); goto VH9hK; YZZNQ: curl_setopt($ch, CURLOPT_URL, $url . '?' . $params); goto WwE6E; Jb1LU: curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); goto k1CZZ; eXhYI: SuVNO: goto A5wag; bcV_E: curl_close($ch); goto Lemmo; L0loS: if ($params) { goto j6eyP; } goto S9AW2; Vmvit: curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.22 (KHTML, like Gecko) Chrome/25.0.1364.172 Safari/537.22'); goto nxKwH; qyLcv: goto RPEKv; goto dNF9_; g5y8s: $httpInfo = array(); goto tUbyJ; XkQ2I: curl_setopt($ch, CURLOPT_TIMEOUT, 30); goto Jb1LU; p_X40: return false; goto eXhYI; S9AW2: curl_setopt($ch, CURLOPT_URL, $url); goto qyLcv; dNF9_: j6eyP: goto YZZNQ; Zt45t: } public function pin_passenger_release_travel_success($travel_id) { goto z6TBv; ew4uK: $acc = WeAccount::create($acid); goto etmcM; bGNNI: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto Qh_Pb; E9q0Z: $conf = pdo_fetch('SELECT travel_release_notify_all_owner_on FROM ' . tablename('navlange_pinche_conf') . ' WHERE uniacid=' . $_W['uniacid']); goto s4YmO; Y34S6: hobNE: goto Ws6Wl; csrB8: $data['keyword4'] = array("value" => $this->hidtel($travel['mobile']), "color" => "#173177"); goto O7R4f; s4YmO: $travel = pdo_fetch('SELECT departure_time,departure_station,departure_city,terminal_station,terminal_city,mobile FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $travel_id); goto bGNNI; X0VXI: $url = $_W['siteroot'] . ltrim($this->createMobileurl('travel_index'), './'); goto fcSwG; O7R4f: $data['remark'] = array("value" => "每一次成功的拼车，都是一次美丽的邂逅！祝您愉快！", "color" => "#173177"); goto X0VXI; q13Jl: reset($acidarr); goto HMktL; t021p: foreach ($owner as $key => $value) { goto A0YSW; A0nXG: if (empty($wechat)) { goto Zxfuj; } goto ChRAB; A0YSW: $wechat = pdo_fetch('SELECT wechats.uniacid FROM ' . tablename('account_wechats') . ' AS wechats LEFT JOIN ' . tablename('mc_members') . ' AS mc_member ON wechats.uniacid=mc_member.uniacid WHERE mc_member.uid=' . $value['uid']); goto A0nXG; ovYXh: E4wO1: goto k2lVv; ChRAB: $acc->sendTplNotice($value['openid'], $message['release_success'], $data, $url, '#FF683F'); goto xN51j; xN51j: Zxfuj: goto ovYXh; k2lVv: } goto F4Gaq; F4Gaq: XniId: goto Y34S6; etmcM: if (!($conf['travel_release_notify_all_owner_on'] == '1')) { goto hobNE; } goto V87oO; V87oO: $owner = pdo_fetchall('SELECT uid,openid FROM ' . tablename('navlange_pinche_owner') . ' WHERE uniacid=' . $_W['uniacid'] . ' AND working_on=\'1\''); goto t021p; vqUZk: $data['keyword1'] = array("value" => date('Y-m-d H:i', $travel['departure_time']), "color" => "#173177"); goto ns46N; N85HB: $acid = $account['acid']; goto ew4uK; HMktL: $account = current($acidarr); goto N85HB; Qh_Pb: $data['first'] = array("value" => "有乘客发布新的出行需求啦!", "color" => "#173177"); goto vqUZk; ns46N: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto omYXA; fcSwG: $acidarr = uni_accounts(); goto q13Jl; omYXA: $data['keyword3'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto csrB8; DjExV: pdo_query('set names \'utf8\''); goto E9q0Z; z6TBv: global $_W; goto DjExV; Ws6Wl: } public function accept_passenger_notify($member_id) { goto Aeh0g; SVbIA: $data['first'] = array("value" => "已经有司机接单，请您及时和司机取得联系！", "color" => "#173177"); goto GldIY; hs0yE: $owner = pdo_fetch('SELECT name, tel FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto erIYY; PAOg1: $acc = WeAccount::create($acid); goto bK9yQ; erIYY: $travel = pdo_fetch('SELECT departure_time,departure_city,departure_station,terminal_city,terminal_station FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto qBb03; YuOEg: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto UhDwA; XI_4r: $acidarr = uni_accounts(); goto cao6C; PjpmK: $data['keyword5'] = array("value" => $owner['tel'], "color" => "#173177"); goto j8OpB; rpWlt: $account = current($acidarr); goto Q0Yo3; qBb03: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto SVbIA; j8OpB: $data['remark'] = array("value" => "每一次成功的拼车，都是一次美丽的邂逅！祝您愉快！", "color" => "#173177"); goto BxWjn; cpgib: $member = pdo_fetch('SELECT openid,pin_id,travel_id,openid,owner_id FROM ' . tablename('navlange_pinche_member') . ' WHERe id=' . $member_id); goto hs0yE; Aeh0g: global $_W; goto cpgib; BxWjn: $url = $_W['siteroot'] . ltrim($this->createMobileurl('travel_info', array("id" => $member['travel_id'])), './'); goto XI_4r; bK9yQ: $acc->sendTplNotice($member['openid'], $message['join_result'], $data, $url, '#FF683F'); goto BKxco; WhcRR: $data['keyword4'] = array("value" => $owner['name'], "color" => "#173177"); goto PjpmK; GldIY: $data['keyword1'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto YuOEg; cao6C: reset($acidarr); goto rpWlt; UhDwA: $data['keyword3'] = array("value" => date('Y-m-d H:i', $travel['departure_time']), "color" => "#173177"); goto WhcRR; Q0Yo3: $acid = $account['acid']; goto PAOg1; BKxco: } public function go_to_passenger_departure_station_notify($member_id) { goto VXd9s; M7YmP: $data['first'] = array("value" => "车主已经出发，正在接您上车的途中，请抓紧做好上车准备！", "color" => "#173177"); goto JML30; VlUxA: $member = pdo_fetch('SELECT openid,pin_id,travel_id,openid,owner_id FROM ' . tablename('navlange_pinche_member') . ' WHERe id=' . $member_id); goto slQok; IeUK_: $acc->sendTplNotice($member['openid'], $message['join_result'], $data, $url, '#FF683F'); goto jSO_m; uaaEK: $data['keyword3'] = array("value" => date('Y-m-d H:i', $travel['departure_time']), "color" => "#173177"); goto afkSJ; JML30: $data['keyword1'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto kRi1Q; VXd9s: global $_W; goto VlUxA; afkSJ: $data['keyword4'] = array("value" => $owner['name'], "color" => "#173177"); goto eif6o; eif6o: $data['keyword5'] = array("value" => $owner['tel'], "color" => "#173177"); goto lQbsg; tYWcz: $acc = WeAccount::create($acid); goto IeUK_; kRi1Q: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto uaaEK; QDb4l: $url = $_W['siteroot'] . ltrim($this->createMobileurl('travel_info', array("id" => $member['travel_id'])), './'); goto ylYCu; a2vQr: $account = current($acidarr); goto hrQtz; oh79D: reset($acidarr); goto a2vQr; T4nrD: $travel = pdo_fetch('SELECT departure_time,departure_city,departure_station,terminal_city,terminal_station FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto tnHwF; lQbsg: $data['remark'] = array("value" => "为了您能够按时出行，请提前做好准备，在上车地点等候！", "color" => "#173177"); goto QDb4l; ylYCu: $acidarr = uni_accounts(); goto oh79D; slQok: $owner = pdo_fetch('SELECT name, tel FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto T4nrD; tnHwF: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto M7YmP; hrQtz: $acid = $account['acid']; goto tYWcz; jSO_m: } public function arrive_passenger_departure_station_notify($member_id) { goto wlIcf; dzWeg: $data['keyword3'] = array("value" => date('Y-m-d H:i', $travel['departure_time']), "color" => "#173177"); goto epcIk; wlIcf: global $_W; goto y1FAc; XTiqy: $message = pdo_get('navlange_pinche_message', array("uniacid" => $_W['uniacid'])); goto Rzvgc; gJy88: $travel = pdo_fetch('SELECT departure_time,departure_city,departure_station,terminal_city,terminal_station FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto XTiqy; JGPK_: $url = $_W['siteroot'] . ltrim($this->createMobileurl('travel_info', array("id" => $member['travel_id'])), './'); goto W_QqC; Rzvgc: $data['first'] = array("value" => "车主已经到达上车地点！", "color" => "#173177"); goto UWKOJ; vln6b: $owner = pdo_fetch('SELECT name, tel FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto gJy88; epcIk: $data['keyword4'] = array("value" => $owner['name'], "color" => "#173177"); goto zOKRm; p3Yj3: $acc->sendTplNotice($member['openid'], $message['join_result'], $data, $url, '#FF683F'); goto taf_Y; rDHKm: $account = current($acidarr); goto dpbwS; W_QqC: $acidarr = uni_accounts(); goto XAI1T; JEeN7: $data['remark'] = array("value" => "车主已经在您的上车地点等候，请带好行李及时上车！", "color" => "#173177"); goto JGPK_; UWKOJ: $data['keyword1'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto qhMpQ; dpbwS: $acid = $account['acid']; goto PsUj5; PsUj5: $acc = WeAccount::create($acid); goto p3Yj3; zOKRm: $data['keyword5'] = array("value" => $owner['tel'], "color" => "#173177"); goto JEeN7; XAI1T: reset($acidarr); goto rDHKm; y1FAc: $member = pdo_fetch('SELECT openid,pin_id,travel_id,openid,owner_id FROM ' . tablename('navlange_pinche_member') . ' WHERe id=' . $member_id); goto vln6b; qhMpQ: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto dzWeg; taf_Y: } public function join_pin_notify($member_id) { goto sNVyz; Ewo0d: $url = $_W['siteroot'] . ltrim($this->createMobileurl('info', array("id" => $member['pin_id'])), './'); goto SpRTi; G7BA1: $data['keyword1'] = array("value" => date('Y-m-d H:i:s', $travel['release_time']), "color" => "#173177"); goto goBtz; toz2G: $data['first'] = array("value" => "有乘客加入您的拼车，请及时和乘客联系拼车事宜！", "color" => "#173177"); goto G7BA1; DegAU: if ($travel['name']) { goto m6H23; } goto aEkzy; InaSK: $travel = pdo_fetch('SELECT uid,release_time,boarding_place,name,mobile FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto DegAU; O9SPC: $member = pdo_fetch('SELECT owner_id,pin_id,travel_id FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto InaSK; sNVyz: global $_W; goto O9SPC; DuKJb: m6H23: goto cKRH3; aEkzy: $mc_member = pdo_fetch('SELECT nickname FROM ' . tablename('mc_members') . ' WHERE uid=' . $travel['uid']); goto KHQoO; KHQoO: $travel['name'] = $mc_member['nickname']; goto DuKJb; G_Qlv: Pmkpl: goto SdKE9; nbNWo: $message = pdo_fetch('SELECT join_notice FROM ' . tablename('navlange_pinche_message') . ' WHERE uniacid=' . $_W['uniacid']); goto toz2G; xZHFP: $this->join_notice_sms($owner['tel'], $owner['name'], $travel['mobile']); goto G_Qlv; A3LJe: $account = current($acidarr); goto U67xj; HpW3Z: $acc = WeAccount::create($acid); goto ePftp; H2uY0: if (!($message['sms_on'] == '1')) { goto Pmkpl; } goto xZHFP; ePftp: $res = $acc->sendTplNotice($owner['openid'], $message['join_notice'], $data, $url, '#FF683F'); goto H2uY0; goBtz: $data['keyword2'] = array("value" => $travel['boarding_place'], "color" => "#173177"); goto ijDf2; sfbuX: $data['remark'] = array("value" => "每一次成功的拼车，都是一次美丽的邂逅！祝您愉快！", "color" => "#173177"); goto Ewo0d; ijDf2: $data['keyword3'] = array("value" => $travel['name'], "color" => "#173177"); goto qPAi2; HVpl4: reset($acidarr); goto A3LJe; SpRTi: $acidarr = uni_accounts(); goto HVpl4; U67xj: $acid = $account['acid']; goto HpW3Z; qPAi2: $data['keyword4'] = array("value" => $travel['mobile'], "color" => "#173177"); goto sfbuX; cKRH3: $owner = pdo_fetch('SELECT openid,tel,name FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto nbNWo; SdKE9: } public function pay_notify($member_id) { goto rCdZf; Yc7PE: $data['first'] = array("value" => "乘客已经付款！", "color" => "#173177"); goto BhA1Z; BhA1Z: $data['keyword1'] = array("value" => $travel['name'], "color" => "#173177"); goto kyBpA; YDWds: $owner = pdo_fetch('SELECT openid FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto W1LiJ; MfEO5: $acid = $account['acid']; goto tGEd2; PUTDm: reset($acidarr); goto fpwco; W1LiJ: $message = pdo_fetch('SELECT pay FROM ' . tablename('navlange_pinche_message') . ' WHERE uniacid=' . $_W['uniacid']); goto Yc7PE; IpQlt: $data['remark'] = array("value" => "感谢你的使用！", "color" => "#173177"); goto YytkC; fpwco: $account = current($acidarr); goto MfEO5; kyBpA: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto H7oMg; bBOh5: $res = $acc->sendTplNotice($owner['openid'], $message['pay'], $data, $url, '#FF683F'); goto o628D; xeWoL: $acidarr = uni_accounts(); goto PUTDm; a1H46: $member = pdo_fetch('SELECT owner_id,pin_id,travel_id,payed_money FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto mqWzu; tGEd2: $acc = WeAccount::create($acid); goto bBOh5; mqWzu: $travel = pdo_fetch('SELECT departure_city,departure_station,terminal_city,terminal_station,name FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto YDWds; V1Waf: $data['keyword5'] = array("value" => date('Y-m-d H:i:s', TIMESTAMP), "color" => "#173177"); goto IpQlt; aOuCo: $data['keyword4'] = array("value" => $member['payed_money'], "color" => "#173177"); goto V1Waf; rCdZf: global $_W; goto a1H46; H7oMg: $data['keyword3'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto aOuCo; YytkC: $url = $_W['siteroot'] . ltrim($this->createMobileurl('info', array("id" => $member['pin_id'])), './'); goto xeWoL; o628D: } public function owner_cancel_notify($member_id) { goto wsQ9C; DxVIk: $data['keyword4'] = array("value" => (TIMESTAMP - $member['owner_arrived_departure_station_time']) / 60, "color" => "#173177"); goto ri3_E; LSqYt: $data['remark'] = array("value" => "感谢你的使用！", "color" => "#173177"); goto Cydg0; wsQ9C: global $_W; goto ARGQK; ARGQK: $member = pdo_fetch('SELECT openid,owner_id,travel_id,owner_arrived_departure_station_time,owner_cancel_reason FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto zcW_O; X0aLM: $message = pdo_fetch('SELECT owner_cancel FROM ' . tablename('navlange_pinche_message') . ' WHERE uniacid=' . $_W['uniacid']); goto k_hz5; zcW_O: $owner = pdo_fetch('SELECT name FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto X0aLM; Cydg0: $url = $_W['siteroot'] . ltrim($this->createMobileurl('travel_info', array("id" => $member['travel_id'])), './'); goto KpC0_; Fb5Ug: $acc = WeAccount::create($acid); goto YvtM7; uidYg: $data['keyword1'] = array("value" => $owner['name'], "color" => "#173177"); goto Cl5nz; mhIWM: $account = current($acidarr); goto ip0D3; KpC0_: $acidarr = uni_accounts(); goto nvgxz; k_hz5: $data['first'] = array("value" => "车主取消了您的订单！", "color" => "#173177"); goto uidYg; ip0D3: $acid = $account['acid']; goto Fb5Ug; HGmWN: $data['keyword3'] = array("value" => date('Y-m-d H:i:s', TIMESTAMP), "color" => "#173177"); goto DxVIk; YvtM7: $res = $acc->sendTplNotice($member['openid'], $message['owner_cancel'], $data, $url, '#FF683F'); goto dUp09; ri3_E: $data['keyword5'] = array("value" => $member['owner_cancel_reason'], "color" => "#173177"); goto LSqYt; nvgxz: reset($acidarr); goto mhIWM; Cl5nz: $data['keyword2'] = array("value" => date('Y-m-d H:i:s', $member['owner_arrived_departure_station_time']), "color" => "#173177"); goto HGmWN; dUp09: } public function passenger_cancel_notify($member_id) { goto dZMp5; j324T: $member = pdo_fetch('SELECT owner_id,travel_id,pin_id,cancel_reason FROM ' . tablename('navlange_pinche_member') . ' WHERE id=' . $member_id); goto EtA4C; gSMV9: $owner = pdo_fetch('SELECT openid FROM ' . tablename('navlange_pinche_owner') . ' WHERE id=' . $member['owner_id']); goto eilMG; eilMG: $message = pdo_fetch('SELECT passenger_cancel FROM ' . tablename('navlange_pinche_message') . ' WHERE uniacid=' . $_W['uniacid']); goto nX7lg; UtVq1: $data['keyword4'] = array("value" => $member['cancel_reason'], "color" => "#173177"); goto I7Rx8; k9n3B: $account = current($acidarr); goto wpKN1; EtA4C: $travel = pdo_fetch('SELECT uid,name,departure_city,departure_station,terminal_city,terminal_station FROM ' . tablename('navlange_pinche_travel') . ' WHERE id=' . $member['travel_id']); goto ynf4e; da6w_: $mc_member = pdo_fetch('SELECT nickname FROM ' . tablename('mc_members') . ' WHERE uid=' . $travel['uid']); goto i3PKc; W0ltR: $data['keyword2'] = array("value" => $this->rtrim_cn($travel['departure_city'], '市') . '-' . $travel['departure_station'], "color" => "#173177"); goto RE4eh; ynf4e: if ($travel['name']) { goto vXCuK; } goto da6w_; wpKN1: $acid = $account['acid']; goto NG12L; RE4eh: $data['keyword3'] = array("value" => $this->rtrim_cn($travel['terminal_city'], '市') . '-' . $travel['terminal_station'], "color" => "#173177"); goto UtVq1; i3PKc: $travel['name'] = $mc_member['nickname']; goto ddj3l; HsMlr: $data['keyword1'] = array("value" => $travel['name'], "color" => "#173177"); goto W0ltR; NG12L: $acc = WeAccount::create($acid); goto ufti4; OAEZZ: $url = $_W['siteroot'] . ltrim($this->createMobileurl('info', array("id" => $member['pin_id'])), './'); goto bc6XO; ufti4: $res = $acc->sendTplNotice($owner['openid'], $message['passenger_cancel'], $data, $url, '#FF683F'); goto qaihO; dZMp5: global $_W; goto j324T; bQ9lw: reset($acidarr); goto k9n3B; nX7lg: $data['first'] = array("value" => "很抱歉，有乘客取消了订单！", "color" => "#173177"); goto HsMlr; bc6XO: $acidarr = uni_accounts(); goto bQ9lw; e0JZZ: $data['remark'] = array("value" => "感谢你的使用！", "color" => "#173177"); goto OAEZZ; ddj3l: vXCuK: goto gSMV9; I7Rx8: $data['keyword5'] = array("value" => date('Y-m-d H:i:s', TIMESTAMP), "color" => "#173177"); goto e0JZZ; qaihO: } } ?>